/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../math/Vector3","../math/Vector4"],(function(r,a,o){"use strict";function e(r,a,o){var e=o.length-r-1;if(a>=o[e])return e-1;if(a<=o[r])return r;for(var n=r,v=e,t=Math.floor((n+v)/2);a<o[t]||a>=o[t+1];)a<o[t]?v=t:n=t,t=Math.floor((n+v)/2);return t}function n(r,a,o,e){var n=[],v=[],t=[];n[0]=1;for(var c=1;c<=o;++c){v[c]=a-e[r+1-c],t[c]=e[r+c]-a;for(var f=0,i=0;i<c;++i){var l=t[i+1],u=v[c-i],s=n[i]/(l+u);n[i]=f+l*s,f=u*s}n[c]=f}return n}function v(r,a,o,e,n){for(var v=[],t=0;t<=o;++t)v[t]=0;for(var c=[],f=0;f<=e;++f)c[f]=v.slice(0);for(var i=[],l=0;l<=o;++l)i[l]=v.slice(0);i[0][0]=1;for(var u=v.slice(0),s=v.slice(0),d=1;d<=o;++d){u[d]=a-n[r+1-d],s[d]=n[r+d]-a;for(var p=0,w=0;w<d;++w){var y=s[w+1],S=u[d-w];i[d][w]=y+S;var h=i[w][d-1]/i[d][w];i[w][d]=p+y*h,p=S*h}i[d][d]=p}for(var m=0;m<=o;++m)c[0][m]=i[m][o];for(var x=0;x<=o;++x){for(var B=0,V=1,z=[],D=0;D<=o;++D)z[D]=v.slice(0);z[0][0]=1;for(var g=1;g<=e;++g){var M=0,b=x-g,F=o-g;x>=g&&(z[V][0]=z[B][0]/i[F+1][b],M=z[V][0]*i[b][F]);for(var P=x-1<=F?g-1:o-x,R=b>=-1?1:-b;R<=P;++R)z[V][R]=(z[B][R]-z[B][R-1])/i[F+1][b+R],M+=z[V][R]*i[b+R][F];x<=F&&(z[V][g]=-z[B][g-1]/i[F+1][x],M+=z[V][g]*i[x][F]),c[g][x]=M;var _=B;B=V,V=_}}for(var j=o,C=1;C<=e;++C){for(var I=0;I<=o;++I)c[C][I]*=j;j*=o-C}return c}function t(r,a,n,t,c){for(var f=c<r?c:r,i=[],l=e(r,t,a),u=v(l,t,r,f,a),s=[],d=0;d<n.length;++d){var p=n[d].clone(),w=p.w;p.x*=w,p.y*=w,p.z*=w,s[d]=p}for(var y=0;y<=f;++y){for(var S=s[l-r].clone().multiplyScalar(u[y][0]),h=1;h<=r;++h)S.add(s[l-r+h].clone().multiplyScalar(u[y][h]));i[y]=S}for(var m=f+1;m<=c+1;++m)i[m]=new o.Vector4(0,0,0);return i}function c(r,a){for(var o=1,e=2;e<=r;++e)o*=e;for(var n=1,v=2;v<=a;++v)n*=v;for(var t=2;t<=r-a;++t)n*=t;return o/n}function f(r){for(var o=r.length,e=[],n=[],v=0;v<o;++v){var t=r[v];e[v]=new a.Vector3(t.x,t.y,t.z),n[v]=t.w}for(var f=[],i=0;i<o;++i){for(var l=e[i].clone(),u=1;u<=i;++u)l.sub(f[i-u].clone().multiplyScalar(c(i,u)*n[u]));f[i]=l.divideScalar(n[0])}return f}r.calcBSplineDerivatives=t,r.calcBSplinePoint=function(r,a,v,t){for(var c=e(r,t,a),f=n(c,t,r,a),i=new o.Vector4(0,0,0,0),l=0;l<=r;++l){var u=v[c-r+l],s=f[l],d=u.w*s;i.x+=u.x*d,i.y+=u.y*d,i.z+=u.z*d,i.w+=u.w*s}return i},r.calcBasisFunctionDerivatives=v,r.calcBasisFunctions=n,r.calcKoverI=c,r.calcNURBSDerivatives=function(r,a,o,e,n){return f(t(r,a,o,e,n))},r.calcRationalCurveDerivatives=f,r.findSpan=e,Object.defineProperty(r,"__esModule",{value:!0})}));
