/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../math/Matrix3","../math/Matrix4","../math/Vector3","./VolumeSlice"],(function(t,e,i,n,a){"use strict";var s=function(){function t(t,i,n,a,s){if(void 0!==t){switch(this.xLength=Number(t)||1,this.yLength=Number(i)||1,this.zLength=Number(n)||1,this.axisOrder=["x","y","z"],a){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":default:this.data=new Uint8Array(s);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(s);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(s);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(s);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(s);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(s);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("Error in Volume constructor : this type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(s);break;case"Float64":case"float64":case"double":this.data=new Float64Array(s)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("Error in Volume constructor, lengths are not matching arrayBuffer size")}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new e.Matrix3,this.matrix.identity();var r=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return r},set:function(t){r=t,this.sliceList.forEach((function(t){t.geometryNeedsUpdate=!0}))}});var h=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return h},set:function(t){h=t,this.sliceList.forEach((function(t){t.geometryNeedsUpdate=!0}))}}),this.sliceList=[]}var s=t.prototype;return s.getData=function(t,e,i){return this.data[i*this.xLength*this.yLength+e*this.xLength+t]},s.access=function(t,e,i){return i*this.xLength*this.yLength+e*this.xLength+t},s.reverseAccess=function(t){var e=Math.floor(t/(this.yLength*this.xLength)),i=Math.floor((t-e*this.yLength*this.xLength)/this.xLength);return[t-e*this.yLength*this.xLength-i*this.xLength,i,e]},s.map=function(t,e){var i=this.data.length;e=e||this;for(var n=0;n<i;n++)this.data[n]=t.call(e,this.data[n],n,this.data);return this},s.extractPerpendicularPlane=function(t,e){var a,s,r,h,o=new n.Vector3,c=new n.Vector3,u=new n.Vector3,g=(new i.Matrix4).identity(),l=this,d=new n.Vector3(this.xLength,this.yLength,this.zLength);switch(t){case"x":o.set(1,0,0),c.set(0,0,-1),u.set(0,-1,0),a=this.spacing[this.axisOrder.indexOf("z")],s=this.spacing[this.axisOrder.indexOf("y")],h=new n.Vector3(e,0,0),g.multiply((new i.Matrix4).makeRotationY(Math.PI/2)),r=(l.RASDimensions[0]-1)/2,g.setPosition(new n.Vector3(e-r,0,0));break;case"y":o.set(0,1,0),c.set(1,0,0),u.set(0,0,1),a=this.spacing[this.axisOrder.indexOf("x")],s=this.spacing[this.axisOrder.indexOf("z")],h=new n.Vector3(0,e,0),g.multiply((new i.Matrix4).makeRotationX(-Math.PI/2)),r=(l.RASDimensions[1]-1)/2,g.setPosition(new n.Vector3(0,e-r,0));break;default:o.set(0,0,1),c.set(1,0,0),u.set(0,-1,0),a=this.spacing[this.axisOrder.indexOf("x")],s=this.spacing[this.axisOrder.indexOf("y")],h=new n.Vector3(0,0,e),r=(l.RASDimensions[2]-1)/2,g.setPosition(new n.Vector3(0,0,e-r))}c.applyMatrix4(l.inverseMatrix).normalize(),c.arglet="i",u.applyMatrix4(l.inverseMatrix).normalize(),u.arglet="j",o.applyMatrix4(l.inverseMatrix).normalize();var f=Math.floor(Math.abs(c.dot(d))),x=Math.floor(Math.abs(u.dot(d))),p=Math.abs(f*a),y=Math.abs(x*s);h=Math.abs(Math.round(h.applyMatrix4(l.inverseMatrix).dot(o)));var M=[new n.Vector3(1,0,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1)],m=[c,u,o].find((function(t){return Math.abs(t.dot(M[0]))>.9})),w=[c,u,o].find((function(t){return Math.abs(t.dot(M[1]))>.9})),L=[c,u,o].find((function(t){return Math.abs(t.dot(M[2]))>.9}));return{iLength:f,jLength:x,sliceAccess:function(t,e){var i=m===o?h:"i"===m.arglet?t:e,n=w===o?h:"i"===w.arglet?t:e,a=L===o?h:"i"===L.arglet?t:e,s=m.dot(M[0])>0?i:l.xLength-1-i,r=w.dot(M[1])>0?n:l.yLength-1-n,c=L.dot(M[2])>0?a:l.zLength-1-a;return l.access(s,r,c)},matrix:g,planeWidth:p,planeHeight:y}},s.extractSlice=function(t,e){var i=new a.VolumeSlice(this,e,t);return this.sliceList.push(i),i},s.repaintAllSlices=function(){return this.sliceList.forEach((function(t){t.repaint()})),this},s.computeMinMax=function(){var t=1/0,e=-1/0,i=this.data.length,n=0;for(n=0;n<i;n++)if(!isNaN(this.data[n])){var a=this.data[n];t=Math.min(t,a),e=Math.max(e,a)}return this.min=t,this.max=e,[t,e]},t}();t.Volume=s,Object.defineProperty(t,"__esModule",{value:!0})}));
