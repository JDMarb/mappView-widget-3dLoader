/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","./Cache","./Loader","../Fetch"],(function(e,r,t,n,o){"use strict";var a={},s=function(e){function n(r){return e.call(this,r)||this}r.inheritsLoose(n,e);var s=n.prototype;return s.load=function(e,r,n,s){var i=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var u=t.Cache.get(e);if(void 0!==u)return this.manager.itemStart(e),setTimeout((function(){r&&r(u),i.manager.itemEnd(e)}),0),u;if(void 0===a[e]){a[e]=[],a[e].push({onLoad:r,onProgress:n,onError:s});var d=new o.Request(e,{headers:new o.Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),h=this.mimeType,c=this.responseType;o.fetch(d).then((function(r){if(200===r.status||0===r.status){if(0===r.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===r.body||void 0===r.body.getReader)return r;var t=a[e],n=r.body.getReader(),s=r.headers.get("Content-Length"),i=s?parseInt(s):0,u=0!==i,d=0,h=new ReadableStream({start:function(e){!function r(){n.read().then((function(n){var o=n.done,a=n.value;if(o)e.close();else{d+=a.byteLength;for(var s=new ProgressEvent("progress",{lengthComputable:u,loaded:d,total:i}),h=0,c=t.length;h<c;h++){var f=t[h];f.onProgress&&f.onProgress(s)}e.enqueue(a),r()}}))}()}});return new o.Response(h)}throw Error('fetch for "'+r.url+'" responded with '+r.status+": "+r.statusText)})).then((function(e){switch(c){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,h)}));case"json":return e.json();default:if(void 0===h)return e.text();var r=/charset="?([^;"\s]*)"?/i.exec(h),t=r&&r[1]?r[1].toLowerCase():void 0,n=new TextDecoder(t);return e.arrayBuffer().then((function(e){return n.decode(e)}))}})).then((function(r){t.Cache.add(e,r);var n=a[e];delete a[e];for(var o=0,s=n.length;o<s;o++){var u=n[o];u.onLoad&&u.onLoad(r)}i.manager.itemEnd(e)})).catch((function(r){var t=a[e];if(void 0===t)throw i.manager.itemError(e),r;delete a[e];for(var n=0,o=t.length;n<o;n++){var s=t[n];s.onError&&s.onError(r)}i.manager.itemError(e)})),this.manager.itemStart(e)}else a[e].push({onLoad:r,onProgress:n,onError:s})},s.setResponseType=function(e){return this.responseType=e,this},s.setMimeType=function(e){return this.mimeType=e,this},n}(n.Loader);e.FileLoader=s,Object.defineProperty(e,"__esModule",{value:!0})}));
