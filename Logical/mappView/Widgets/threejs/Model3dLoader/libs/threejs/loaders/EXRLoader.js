/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","./DataTextureLoader","../extras/DataUtils","../constants","../libs/fflate.module"],(function(e,r,n,a,t,i){"use strict";var o=function(e){function n(r){var n;return(n=e.call(this,r)||this).type=t.HalfFloatType,n}r.inheritsLoose(n,e);var o=n.prototype;return o.parse=function(e){var r=65536,n=14,o=65537,l=16384,s=Math.pow(2.7182818,2.2);var u={l:0,c:0,lc:0};function f(e,r,n,a,t){for(;n<e;)r=r<<8|W(a,t),n+=8;n-=e,u.l=r>>n&(1<<e)-1,u.c=r,u.lc=n}var c=new Array(59);function v(e,r,n,a,t,i){for(var l=r,s=0,v=0;a<=t;a++){if(l.value-r.value>n)return!1;f(6,s,v,e,l);var h=u.l;if(s=u.c,v=u.lc,i[a]=h,63==h){if(l.value-r.value>n)throw new Error("Something wrong with hufUnpackEncTable");f(8,s,v,e,l);var w=u.l+6;if(s=u.c,v=u.lc,a+w>t+1)throw new Error("Something wrong with hufUnpackEncTable");for(;w--;)i[a++]=0;a--}else if(h>=59){var p=h-59+2;if(a+p>t+1)throw new Error("Something wrong with hufUnpackEncTable");for(;p--;)i[a++]=0;a--}}!function(e){for(var r=0;r<=58;++r)c[r]=0;for(var n=0;n<o;++n)c[e[n]]+=1;for(var a=0,t=58;t>0;--t){var i=a+c[t]>>1;c[t]=a,a=i}for(var l=0;l<o;++l){var s=e[l];s>0&&(e[l]=s|c[s]++<<6)}}(i)}function h(e){return 63&e}function w(e){return e>>6}var p={c:0,lc:0};function d(e,r,n,a){e=e<<8|W(n,a),r+=8,p.c=e,p.lc=r}var y={c:0,lc:0};function S(e,r,n,a,t,i,o,l,s){if(e==r){a<8&&(d(n,a,t,i),n=p.c,a=p.lc);var u=n>>(a-=8);if(u=new Uint8Array([u])[0],l.value+u>s)return!1;for(var f=o[l.value-1];u-- >0;)o[l.value++]=f}else{if(!(l.value<s))return!1;o[l.value++]=e}y.c=n,y.lc=a}function b(e){return 65535&e}function g(e){var r=b(e);return r>32767?r-65536:r}var m={a:0,b:0};function E(e,r){var n=g(e),a=g(r),t=n+(1&a)+(a>>1),i=t,o=t-a;m.a=i,m.b=o}function A(e,r){var n=b(e),a=b(r),t=n-(a>>1)&65535,i=a+t-32768&65535;m.a=i,m.b=t}function U(e,r,n,a,t,i,o){for(var l,s,u=o<16384,f=n>t?t:n,c=1;c<=f;)c<<=1;for(l=c>>=1,c>>=1;c>=1;){for(var v=(s=0)+i*(t-l),h=i*c,w=i*l,p=a*c,d=a*l,y=void 0,S=void 0,b=void 0,g=void 0;s<=v;s+=w){for(var U=s,M=s+a*(n-l);U<=M;U+=d){var z=U+p,C=U+h,R=C+p;u?(E(e[U+r],e[C+r]),y=m.a,b=m.b,E(e[z+r],e[R+r]),S=m.a,g=m.b,E(y,S),e[U+r]=m.a,e[z+r]=m.b,E(b,g),e[C+r]=m.a,e[R+r]=m.b):(A(e[U+r],e[C+r]),y=m.a,b=m.b,A(e[z+r],e[R+r]),S=m.a,g=m.b,A(y,S),e[U+r]=m.a,e[z+r]=m.b,A(b,g),e[C+r]=m.a,e[R+r]=m.b)}if(n&c){var O=U+h;u?E(e[U+r],e[O+r]):A(e[U+r],e[O+r]),y=m.a,e[O+r]=m.b,e[U+r]=y}}if(t&c)for(var x=s,I=s+a*(n-l);x<=I;x+=d){var P=x+p;u?E(e[x+r],e[P+r]):A(e[x+r],e[P+r]),y=m.a,e[P+r]=m.b,e[x+r]=y}l=c,c>>=1}return s}function M(e,r,a,t,i,s){var u=a.value,f=V(r,a),c=V(r,a);a.value+=4;var b=V(r,a);if(a.value+=4,f<0||f>=o||c<0||c>=o)throw new Error("Something wrong with HUF_ENCSIZE");var g=new Array(o),m=new Array(l);if(function(e){for(var r=0;r<l;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}(m),v(e,a,t-(a.value-u),f,c,g),b>8*(t-(a.value-u)))throw new Error("Something wrong with hufUncompress");!function(e,r,a,t){for(;r<=a;r++){var i=w(e[r]),o=h(e[r]);if(i>>o)throw new Error("Invalid table entry");if(o>n){var l=t[i>>o-n];if(l.len)throw new Error("Invalid table entry");if(l.lit++,l.p){var s=l.p;l.p=new Array(l.lit);for(var u=0;u<l.lit-1;++u)l.p[u]=s[u]}else l.p=new Array(1);l.p[l.lit-1]=r}else if(o)for(var f=0,c=1<<n-o;c>0;c--){var v=t[(i<<n-o)+f];if(v.len||v.p)throw new Error("Invalid table entry");v.len=o,v.lit=r,f++}}}(g,f,c,m),function(e,r,a,t,i,o,l,s,u){for(var f=0,c=0,v=l,b=Math.trunc(t.value+(i+7)/8);t.value<b;)for(d(f,c,a,t),f=p.c,c=p.lc;c>=n;){var g=r[f>>c-n&16383];if(g.len)c-=g.len,S(g.lit,o,f,c,a,t,s,u,v),f=y.c,c=y.lc;else{if(!g.p)throw new Error("hufDecode issues");var m=void 0;for(m=0;m<g.lit;m++){for(var E=h(e[g.p[m]]);c<E&&t.value<b;)d(f,c,a,t),f=p.c,c=p.lc;if(c>=E&&w(e[g.p[m]])==(f>>c-E&(1<<E)-1)){c-=E,S(g.p[m],o,f,c,a,t,s,u,v),f=y.c,c=y.lc;break}}if(m==g.lit)throw new Error("hufDecode issues")}}var A=8-i&7;for(f>>=A,c-=A;c>0;){var U=r[f<<n-c&16383];if(!U.len)throw new Error("hufDecode issues");c-=U.len,S(U.lit,o,f,c,a,t,s,u,v),f=y.c,c=y.lc}}(g,m,e,a,b,c,s,i,{value:0})}function z(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function C(e,r){for(var n=0,a=Math.floor((e.length+1)/2),t=0,i=e.length-1;!(t>i||(r[t++]=e[n++],t>i));)r[t++]=e[a++]}function R(e){for(var r=e.byteLength,n=new Array,a=0,t=new DataView(e);r>0;){var i=t.getInt8(a++);if(i<0){var o=-i;r-=o+1;for(var l=0;l<o;l++)n.push(t.getUint8(a++))}else{var s=i;r-=2;for(var u=t.getUint8(a++),f=0;f<s+1;f++)n.push(u)}}return n}function O(e,r,n){for(var a,t=1;t<64;)65280==(a=r[e.value])?t=64:a>>8==255?t+=255&a:(n[t]=a,t++),e.value++}function x(e,r){r[0]=q(e[0]),r[1]=q(e[1]),r[2]=q(e[5]),r[3]=q(e[6]),r[4]=q(e[14]),r[5]=q(e[15]),r[6]=q(e[27]),r[7]=q(e[28]),r[8]=q(e[2]),r[9]=q(e[4]),r[10]=q(e[7]),r[11]=q(e[13]),r[12]=q(e[16]),r[13]=q(e[26]),r[14]=q(e[29]),r[15]=q(e[42]),r[16]=q(e[3]),r[17]=q(e[8]),r[18]=q(e[12]),r[19]=q(e[17]),r[20]=q(e[25]),r[21]=q(e[30]),r[22]=q(e[41]),r[23]=q(e[43]),r[24]=q(e[9]),r[25]=q(e[11]),r[26]=q(e[18]),r[27]=q(e[24]),r[28]=q(e[31]),r[29]=q(e[40]),r[30]=q(e[44]),r[31]=q(e[53]),r[32]=q(e[10]),r[33]=q(e[19]),r[34]=q(e[23]),r[35]=q(e[32]),r[36]=q(e[39]),r[37]=q(e[45]),r[38]=q(e[52]),r[39]=q(e[54]),r[40]=q(e[20]),r[41]=q(e[22]),r[42]=q(e[33]),r[43]=q(e[38]),r[44]=q(e[46]),r[45]=q(e[51]),r[46]=q(e[55]),r[47]=q(e[60]),r[48]=q(e[21]),r[49]=q(e[34]),r[50]=q(e[37]),r[51]=q(e[47]),r[52]=q(e[50]),r[53]=q(e[56]),r[54]=q(e[59]),r[55]=q(e[61]),r[56]=q(e[35]),r[57]=q(e[36]),r[58]=q(e[48]),r[59]=q(e[49]),r[60]=q(e[57]),r[61]=q(e[58]),r[62]=q(e[62]),r[63]=q(e[63])}function I(e){for(var r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),a=.5*Math.cos(3.14159/8),t=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(1.374445625),s=new Array(4),u=new Array(4),f=new Array(4),c=new Array(4),v=0;v<8;++v){var h=8*v;s[0]=a*e[h+2],s[1]=o*e[h+2],s[2]=a*e[h+6],s[3]=o*e[h+6],u[0]=n*e[h+1]+t*e[h+3]+i*e[h+5]+l*e[h+7],u[1]=t*e[h+1]-l*e[h+3]-n*e[h+5]-i*e[h+7],u[2]=i*e[h+1]-n*e[h+3]+l*e[h+5]+t*e[h+7],u[3]=l*e[h+1]-i*e[h+3]+t*e[h+5]-n*e[h+7],f[0]=r*(e[h+0]+e[h+4]),f[3]=r*(e[h+0]-e[h+4]),f[1]=s[0]+s[3],f[2]=s[1]-s[2],c[0]=f[0]+f[1],c[1]=f[3]+f[2],c[2]=f[3]-f[2],c[3]=f[0]-f[1],e[h+0]=c[0]+u[0],e[h+1]=c[1]+u[1],e[h+2]=c[2]+u[2],e[h+3]=c[3]+u[3],e[h+4]=c[3]-u[3],e[h+5]=c[2]-u[2],e[h+6]=c[1]-u[1],e[h+7]=c[0]-u[0]}for(var w=0;w<8;++w)s[0]=a*e[16+w],s[1]=o*e[16+w],s[2]=a*e[48+w],s[3]=o*e[48+w],u[0]=n*e[8+w]+t*e[24+w]+i*e[40+w]+l*e[56+w],u[1]=t*e[8+w]-l*e[24+w]-n*e[40+w]-i*e[56+w],u[2]=i*e[8+w]-n*e[24+w]+l*e[40+w]+t*e[56+w],u[3]=l*e[8+w]-i*e[24+w]+t*e[40+w]-n*e[56+w],f[0]=r*(e[w]+e[32+w]),f[3]=r*(e[w]-e[32+w]),f[1]=s[0]+s[3],f[2]=s[1]-s[2],c[0]=f[0]+f[1],c[1]=f[3]+f[2],c[2]=f[3]-f[2],c[3]=f[0]-f[1],e[0+w]=c[0]+u[0],e[8+w]=c[1]+u[1],e[16+w]=c[2]+u[2],e[24+w]=c[3]+u[3],e[32+w]=c[3]-u[3],e[40+w]=c[2]-u[2],e[48+w]=c[1]-u[1],e[56+w]=c[0]-u[0]}function P(e){for(var r=0;r<64;++r){var n=e[0][r],a=e[1][r],t=e[2][r];e[0][r]=n+1.5747*t,e[1][r]=n-.1873*a-.4682*t,e[2][r]=n+1.8556*a}}function k(e,r,n){for(var t=0;t<64;++t)r[n+t]=a.toHalfFloat(L(e[t]))}function L(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(s,Math.abs(e)-1)}function N(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function T(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(R(r)),a=new Uint8Array(n.length);return z(n),C(n,a),new DataView(a.buffer)}function _(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===i&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var n=i.unzlibSync(r),a=new Uint8Array(n.length);return z(n),C(n,a),new DataView(a.buffer)}function D(e){for(var n=e.viewer,a={value:e.offset.value},t=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),o=0,l=new Array(e.channels),s=0;s<e.channels;s++)l[s]={},l[s].start=o,l[s].end=l[s].start,l[s].nx=e.width,l[s].ny=e.lines,l[s].size=e.type,o+=l[s].nx*l[s].ny*l[s].size;var u=J(n,a),f=J(n,a);if(f>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(u<=f)for(var c=0;c<f-u+1;c++)i[c+u]=Z(n,a);var v=new Uint16Array(r),h=function(e,n){for(var a=0,t=0;t<r;++t)(0==t||e[t>>3]&1<<(7&t))&&(n[a++]=t);for(var i=a-1;a<r;)n[a++]=0;return i}(i,v),w=V(n,a);M(e.array,n,a,w,t,o);for(var p=0;p<e.channels;++p)for(var d=l[p],y=0;y<l[p].size;++y)U(t,d.start+y,d.nx,d.size,d.ny,d.nx*d.size,h);!function(e,r,n){for(var a=0;a<n;++a)r[a]=e[r[a]]}(v,t,o);for(var S=0,b=new Uint8Array(t.buffer.byteLength),g=0;g<e.lines;g++)for(var m=0;m<e.channels;m++){var E=l[m],A=E.nx*E.size,z=new Uint8Array(t.buffer,2*E.end,2*A);b.set(z,S),S+=2*A,E.end+=A}return new DataView(b.buffer)}function F(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===i&&console.error("THREE.EXRLoader: External library fflate.min.js required.");for(var n=i.unzlibSync(r),a=e.lines*e.channels*e.width,t=1==e.type?new Uint16Array(a):new Uint32Array(a),o=0,l=0,s=new Array(4),u=0;u<e.lines;u++)for(var f=0;f<e.channels;f++){var c=0;switch(e.type){case 1:s[0]=o,s[1]=s[0]+e.width,o=s[1]+e.width;for(var v=0;v<e.width;++v){c+=n[s[0]++]<<8|n[s[1]++],t[l]=c,l++}break;case 2:s[0]=o,s[1]=s[0]+e.width,s[2]=s[1]+e.width,o=s[2]+e.width;for(var h=0;h<e.width;++h){c+=n[s[0]++]<<24|n[s[1]++]<<16|n[s[2]++]<<8,t[l]=c,l++}}}return new DataView(t.buffer)}function X(e){var r=e.viewer,n={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),t={version:Y(r,n),unknownUncompressedSize:Y(r,n),unknownCompressedSize:Y(r,n),acCompressedSize:Y(r,n),dcCompressedSize:Y(r,n),rleCompressedSize:Y(r,n),rleUncompressedSize:Y(r,n),rleRawSize:Y(r,n),totalAcUncompressedCount:Y(r,n),totalDcUncompressedCount:Y(r,n),acCompression:Y(r,n)};if(t.version<2)throw new Error("EXRLoader.parse: "+ne.compression+" version "+t.version+" is unsupported");for(var o=new Array,l=J(r,n)-2;l>0;){var s=B(r.buffer,n),u=Z(r,n),f=u>>2&3,c=new Int8Array([(u>>4)-1])[0],v=Z(r,n);o.push({name:s,index:c,type:v,compression:f}),l-=s.length+3}for(var h=ne.channels,w=new Array(e.channels),p=0;p<e.channels;++p){var d=w[p]={},y=h[p];d.name=y.name,d.compression=0,d.decoded=!1,d.type=y.pixelType,d.pLinear=y.pLinear,d.width=e.width,d.height=e.lines}for(var S,b,g,m={idx:new Array(3)},E=0;E<e.channels;++E)for(var A=w[E],U=0;U<o.length;++U){var z=o[U];A.name==z.name&&(A.compression=z.compression,z.index>=0&&(m.idx[z.index]=E),A.offset=E)}if(t.acCompressedSize>0)switch(t.acCompression){case 0:S=new Uint16Array(t.totalAcUncompressedCount),M(e.array,r,n,t.acCompressedSize,S,t.totalAcUncompressedCount);break;case 1:var C=e.array.slice(n.value,n.value+t.totalAcUncompressedCount),L=i.unzlibSync(C);S=new Uint16Array(L.buffer),n.value+=t.totalAcUncompressedCount}if(t.dcCompressedSize>0){var N={array:e.array,offset:n,size:t.dcCompressedSize};b=new Uint16Array(_(N).buffer),n.value+=t.dcCompressedSize}if(t.rleRawSize>0){var T=e.array.slice(n.value,n.value+t.rleCompressedSize);g=R(i.unzlibSync(T).buffer),n.value+=t.rleCompressedSize}for(var D=0,F=new Array(w.length),X=0;X<F.length;++X)F[X]=new Array;for(var H=0;H<e.lines;++H)for(var V=0;V<w.length;++V)F[V].push(D),D+=w[V].width*e.type*2;!function(e,r,n,a,t,i){for(var o=new DataView(i.buffer),l=n[e.idx[0]].width,s=n[e.idx[0]].height,u=Math.floor(l/8),f=Math.ceil(l/8),c=Math.ceil(s/8),v=l-8*(f-1),h=s-8*(c-1),w={value:0},p=new Array(3),d=new Array(3),y=new Array(3),S=new Array(3),b=new Array(3),g=0;g<3;++g)b[g]=r[e.idx[g]],p[g]=g<1?0:p[g-1]+f*c,d[g]=new Float32Array(64),y[g]=new Uint16Array(64),S[g]=new Uint16Array(64*f);for(var m=0;m<c;++m){var E=8;m==c-1&&(E=h);for(var A=8,U=0;U<f;++U){U==f-1&&(A=v);for(var M=0;M<3;++M)y[M].fill(0),y[M][0]=t[p[M]++],O(w,a,y[M]),x(y[M],d[M]),I(d[M]);P(d);for(var z=0;z<3;++z)k(d[z],S[z],64*U)}for(var C=0,R=0;R<3;++R){for(var L=n[e.idx[R]].type,N=8*m;N<8*m+E;++N){C=b[R][N];for(var T=0;T<u;++T){var _=64*T+8*(7&N);o.setUint16(C+0*L,S[R][_+0],!0),o.setUint16(C+2*L,S[R][_+1],!0),o.setUint16(C+4*L,S[R][_+2],!0),o.setUint16(C+6*L,S[R][_+3],!0),o.setUint16(C+8*L,S[R][_+4],!0),o.setUint16(C+10*L,S[R][_+5],!0),o.setUint16(C+12*L,S[R][_+6],!0),o.setUint16(C+14*L,S[R][_+7],!0),C+=16*L}}if(u!=f)for(var D=8*m;D<8*m+E;++D)for(var F=b[R][D]+8*u*2*L,X=64*u+8*(7&D),B=0;B<A;++B)o.setUint16(F+2*B*L,S[R][X+B],!0)}}var H=new Uint16Array(l);o=new DataView(i.buffer);for(var V=0;V<3;++V){n[e.idx[V]].decoded=!0;var W=n[e.idx[V]].type;if(2==n[V].type)for(var Z=0;Z<s;++Z){for(var Y=b[V][Z],j=0;j<l;++j)H[j]=o.getUint16(Y+2*j*W,!0);for(var G=0;G<l;++G)o.setFloat32(Y+2*G*W,q(H[G]),!0)}}}(m,F,w,S,b,a);for(var W=0;W<w.length;++W){var j=w[W];if(!j.decoded){if(2!==j.compression)throw new Error("EXRLoader.parse: unsupported channel compression");for(var G=0,K=0,Q=0;Q<e.lines;++Q){for(var $=F[W][G],ee=0;ee<j.width;++ee){for(var re=0;re<2*j.type;++re)a[$++]=g[K+re*j.width*j.height];K++}G++}}}return new DataView(a.buffer)}function B(e,r){for(var n=new Uint8Array(e),a=0;0!=n[r.value+a];)a+=1;var t=(new TextDecoder).decode(n.slice(r.value,r.value+a));return r.value=r.value+a+1,t}function H(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+4,n}function V(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function W(e,r){var n=e[r.value];return r.value=r.value+1,n}function Z(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}var Y=function(e,r){var n=Number(e.getBigInt64(r.value,!0));return r.value+=8,n};function j(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function G(e,r){return a.toHalfFloat(j(e,r))}function q(e){var r=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(r?31===r?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):n/1024*6103515625e-14)}function J(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function K(e,r){return q(J(e,r))}function Q(e,r,n,a,t){return"string"===a||"stringvector"===a||"iccProfile"===a?function(e,r,n){var a=(new TextDecoder).decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,a}(r,n,t):"chlist"===a?function(e,r,n,a){for(var t=n.value,i=[];n.value<t+a-1;){var o=B(r,n),l=H(e,n),s=Z(e,n);n.value+=3;var u=H(e,n),f=H(e,n);i.push({name:o,pixelType:l,pLinear:s,xSampling:u,ySampling:f})}return n.value+=1,i}(e,r,n,t):"chromaticities"===a?function(e,r){return{redX:j(e,r),redY:j(e,r),greenX:j(e,r),greenY:j(e,r),blueX:j(e,r),blueY:j(e,r),whiteX:j(e,r),whiteY:j(e,r)}}(e,n):"compression"===a?function(e,r){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Z(e,r)]}(e,n):"box2i"===a?function(e,r){return{xMin:V(e,r),yMin:V(e,r),xMax:V(e,r),yMax:V(e,r)}}(e,n):"lineOrder"===a?function(e,r){return["INCREASING_Y"][Z(e,r)]}(e,n):"float"===a?j(e,n):"v2f"===a?function(e,r){return[j(e,r),j(e,r)]}(e,n):"v3f"===a?function(e,r){return[j(e,r),j(e,r),j(e,r)]}(e,n):"int"===a?H(e,n):"rational"===a?function(e,r){return[H(e,r),V(e,r)]}(e,n):"timecode"===a?function(e,r){return[V(e,r),V(e,r)]}(e,n):"preview"===a?(n.value+=t,"skipped"):void(n.value+=t)}for(var $=new DataView(e),ee=new Uint8Array(e),re={value:0},ne=function(e,r,n){var a={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");a.version=e.getUint8(4);var t=e.getUint8(5);a.spec={singleTile:!!(2&t),longName:!!(4&t),deepFormat:!!(8&t),multiPart:!!(16&t)},n.value=8;for(var i=!0;i;){var o=B(r,n);if(0==o)i=!1;else{var l=B(r,n),s=Q(e,r,n,l,V(e,n));void 0===s?console.warn("EXRLoader.parse: skipped unknown header attribute type '"+l+"'."):a[o]=s}}if(0!=(-5&t))throw console.error("EXRHeader:",a),new Error("THREE.EXRLoader: provided file is currently unsupported.");return a}($,e,re),ae=function(e,r,n,a,i){var o={size:0,viewer:r,array:n,offset:a,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=N;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=T;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=_;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=_;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=D;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=F;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=X;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=X;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(o.scanlineBlockSize=o.lines,1==o.type)switch(i){case t.FloatType:o.getter=K,o.inputSize=2;break;case t.HalfFloatType:o.getter=J,o.inputSize=2}else{if(2!=o.type)throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".");switch(i){case t.FloatType:o.getter=j,o.inputSize=4;break;case t.HalfFloatType:o.getter=G,o.inputSize=4}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(var l=0;l<o.blockCount;l++)Y(r,a);o.outputChannels=3==o.channels?4:o.channels;var s=o.width*o.height*o.outputChannels;switch(i){case t.FloatType:o.byteArray=new Float32Array(s),o.channels<o.outputChannels&&o.byteArray.fill(1,0,s);break;case t.HalfFloatType:o.byteArray=new Uint16Array(s),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",i)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?(o.format=t.RGBAFormat,o.encoding=t.LinearEncoding):(o.format=t.RedFormat,o.encoding=t.LinearEncoding),o}(ne,$,ee,re,this.type),te={value:0},ie={R:0,G:1,B:2,A:3,Y:0},oe=0;oe<ae.height/ae.scanlineBlockSize;oe++){var le=V($,re);ae.size=V($,re),ae.lines=le+ae.scanlineBlockSize>ae.height?ae.height-le:ae.scanlineBlockSize;var se=ae.size<ae.lines*ae.bytesPerLine?ae.uncompress(ae):N(ae);re.value+=ae.size;for(var ue=0;ue<ae.scanlineBlockSize;ue++){var fe=ue+oe*ae.scanlineBlockSize;if(fe>=ae.height)break;for(var ce=0;ce<ae.channels;ce++)for(var ve=ie[ne.channels[ce].name],he=0;he<ae.width;he++){te.value=(ue*(ae.channels*ae.width)+ce*ae.width+he)*ae.inputSize;var we=(ae.height-1-fe)*(ae.width*ae.outputChannels)+he*ae.outputChannels+ve;ae.byteArray[we]=ae.getter(se,te)}}}return{header:ne,width:ae.width,height:ae.height,data:ae.byteArray,format:ae.format,encoding:ae.encoding,type:this.type}},o.setDataType=function(e){return this.type=e,this},o.load=function(r,n,a,i){return e.prototype.load.call(this,r,(function(e,r){e.encoding=r.encoding,e.minFilter=t.LinearFilter,e.magFilter=t.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,n&&n(e,r)}),a,i)},n}(n.DataTextureLoader);e.EXRLoader=o,Object.defineProperty(e,"__esModule",{value:!0})}));
