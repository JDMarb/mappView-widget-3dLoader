/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","../core/BufferAttribute","../core/BufferGeometry","./FileLoader","./Loader","./LoaderUtils","../libs/fflate.module"],(function(t,e,r,a,n,i,s,o){"use strict";var l=function(t){function i(e){return t.call(this,e)||this}e.inheritsLoose(i,t);var l=i.prototype;return l.load=function(t,e,r,a){var i=this,s=new n.FileLoader(i.manager);s.setPath(i.path),s.setResponseType("arraybuffer"),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(r){try{e(i.parse(r))}catch(e){a?a(e):console.error(e),i.manager.itemError(t)}}),r,a)},l.parse=function(t){function e(t,e){var r=t.length,a=new Int32Array(r+e.length);return a.set(t),a.set(e,r),a}var n=s.LoaderUtils.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==n[0].indexOf("xml")?function(t){function n(t){for(var e="undefined"!=typeof Uint8Array?Uint8Array:Array,r=[],a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,i=a.length;n<i;++n)r[a.charCodeAt(n)]=n;r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63;var s=t.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o,l,u="="===t[s-2]?2:"="===t[s-1]?1:0,f=new e(3*s/4-u),p=u>0?s-4:s,A=0;for(o=0,l=0;o<p;o+=4,l+=3){var d=r[t.charCodeAt(o)]<<18|r[t.charCodeAt(o+1)]<<12|r[t.charCodeAt(o+2)]<<6|r[t.charCodeAt(o+3)];f[A++]=(16711680&d)>>16,f[A++]=(65280&d)>>8,f[A++]=255&d}if(2===u){var v=r[t.charCodeAt(o)]<<2|r[t.charCodeAt(o+1)]>>4;f[A++]=255&v}else if(1===u){var h=r[t.charCodeAt(o)]<<10|r[t.charCodeAt(o+1)]<<4|r[t.charCodeAt(o+2)]>>2;f[A++]=h>>8&255,f[A++]=255&h}return f}function i(t,r){var a,i,l,u,f,p,A=0;if("UInt64"===s.attributes.header_type?A=8:"UInt32"===s.attributes.header_type&&(A=4),"binary"===t.attributes.format&&r){"Float32"===t.attributes.type?a=new Float32Array:"Int32"!==t.attributes.type&&"Int64"!==t.attributes.type||(a=new Int32Array);for(var d=t["#text"],v=n(Array.isArray(d)?d[0]:d),h=v[0],y=1;y<A-1;y++)h|=v[y]<<8*y;var b=(h+3)*A,c=[],x=b+=b%3>0?3-b%3:0;c.push(x);for(var I=3*A,w=0;w<h;w++){for(var g=v[w*A+I],m=1;m<A-1;m++)g|=v[w*A+I+m]<<8*m;x+=g,c.push(x)}for(var F=0;F<c.length-1;F++)i=o.unzlibSync(v.slice(c[F],c[F+1])).buffer,"Float32"===t.attributes.type?(u=i=new Float32Array(i),f=void 0,p=void 0,f=(l=a).length,(p=new Float32Array(f+u.length)).set(l),p.set(u,f),a=p):"Int32"!==t.attributes.type&&"Int64"!==t.attributes.type||(a=e(a,i=new Int32Array(i)));delete t["#text"],"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(a=a.filter((function(t,e){if(e%2!=1)return!0})))}else i="binary"!==t.attributes.format||r?t["#text"]?t["#text"].split(/\s+/).filter((function(t){if(""!==t)return t})):new Int32Array(0).buffer:(i=n(t["#text"])).slice(A).buffer,delete t["#text"],"Float32"===t.attributes.type?a=new Float32Array(i):"Int32"===t.attributes.type?a=new Int32Array(i):"Int64"===t.attributes.type&&(a=new Int32Array(i),"binary"===t.attributes.format&&(a=a.filter((function(t,e){if(e%2!=1)return!0}))));return a}var s=function t(e){var r={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){r.attributes={};for(var a=0;a<e.attributes.length;a++){var n=e.attributes.item(a);r.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===e.nodeType&&(r=e.nodeValue.trim());if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes.item(i),o=s.nodeName;if(void 0===r[o]){var l=t(s);""!==l&&(r[o]=l)}else{if(void 0===r[o].push){var u=r[o];r[o]=[u]}var f=t(s);""!==f&&r[o].push(f)}}return r}((new DOMParser).parseFromString(t,"application/xml").documentElement),l=[],u=[],f=[];if(s.PolyData){for(var p=s.PolyData.Piece,A=s.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],v=0,h=d.length;v<h;){var y=p[d[v]];if(y&&y.DataArray){for(var b=void 0,c=0,x=(b=Array.isArray(y.DataArray)?y.DataArray:[y.DataArray]).length;c<x;)"#text"in b[c]&&b[c]["#text"].length>0&&(b[c].text=i(b[c],A)),c++;switch(d[v]){case"PointData":var I=parseInt(p.attributes.NumberOfPoints),w=y.attributes.Normals;if(I>0)for(var g=0,m=b.length;g<m;g++)if(w===b[g].attributes.Name){var F=b[g].attributes.NumberOfComponents;(u=new Float32Array(I*F)).set(b[g].text,0)}break;case"Points":var D=parseInt(p.attributes.NumberOfPoints);if(D>0){var T=y.DataArray.attributes.NumberOfComponents;(l=new Float32Array(D*T)).set(y.DataArray.text,0)}break;case"Strips":var O=parseInt(p.attributes.NumberOfStrips);if(O>0){var P=new Int32Array(y.DataArray[0].text.length),S=new Int32Array(y.DataArray[1].text.length);P.set(y.DataArray[0].text,0),S.set(y.DataArray[1].text,0);var C=O+P.length;f=new Uint32Array(3*C-9*O);for(var L=0,N=0,U=O;N<U;N++){for(var B=[],E=0,_=S[N],R=0;E<_-R;E++)B.push(P[E]),N>0&&(R=S[N-1]);for(var G=0,k=S[N],V=0;G<k-V-2;G++)G%2?(f[L++]=B[G],f[L++]=B[G+2],f[L++]=B[G+1]):(f[L++]=B[G],f[L++]=B[G+1],f[L++]=B[G+2]),N>0&&(V=S[N-1])}}break;case"Polys":var Y=parseInt(p.attributes.NumberOfPolys);if(Y>0){var H=new Int32Array(y.DataArray[0].text.length),M=new Int32Array(y.DataArray[1].text.length);H.set(y.DataArray[0].text,0),M.set(y.DataArray[1].text,0);var j=Y+H.length;f=new Uint32Array(3*j-9*Y);for(var q=0,z=0,K=0,W=0,J=Y;K<J;){for(var Q=[],X=0,Z=M[K];X<Z-W;)Q.push(H[z++]),X++;for(var $=1;$<Z-W-1;)f[q++]=Q[0],f[q++]=Q[$],f[q++]=Q[$+1],$++;W=M[++K-1]}}}}v++}var tt=new a.BufferGeometry;return tt.setIndex(new r.BufferAttribute(f,1)),tt.setAttribute("position",new r.BufferAttribute(l,3)),u.length===l.length&&tt.setAttribute("normal",new r.BufferAttribute(u,3)),tt}throw new Error("Unsupported DATASET type")}(s.LoaderUtils.decodeText(t)):n[2].includes("ASCII")?function(t){var e,n=[],i=[],s=[],o=[],l=/^[^\d.\s-]+/,u=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,f=/^(\d+)\s+([\s\d]*)/,p=/^POINTS /,A=/^POLYGONS /,d=/^TRIANGLE_STRIPS /,v=/^POINT_DATA[ ]+(\d+)/,h=/^CELL_DATA[ ]+(\d+)/,y=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,b=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,c=!1,x=!1,I=!1,w=!1,g=!1,m=!1,F=!1,D=t.split("\n");for(var T in D){var O=D[T].trim();if(0===O.indexOf("DATASET")){var P=O.split(" ")[1];if("POLYDATA"!==P)throw new Error("Unsupported DATASET type: "+P)}else if(c)for(;null!==(e=u.exec(O))&&null===l.exec(O);){var S=parseFloat(e[1]),C=parseFloat(e[2]),L=parseFloat(e[3]);i.push(S,C,L)}else if(x){if(null!==(e=f.exec(O))){var N=parseInt(e[1]),U=e[2].split(/\s+/);if(N>=3)for(var B=parseInt(U[0]),E=1,_=0;_<N-2;++_){var R=parseInt(U[E]),G=parseInt(U[E+1]);n.push(B,R,G),E++}}}else if(I){if(null!==(e=f.exec(O))){var k=parseInt(e[1]),V=e[2].split(/\s+/);if(k>=3)for(var Y=0;Y<k-2;Y++)if(Y%2==1){var H=parseInt(V[Y]),M=parseInt(V[Y+2]),j=parseInt(V[Y+1]);n.push(H,M,j)}else{var q=parseInt(V[Y]),z=parseInt(V[Y+1]),K=parseInt(V[Y+2]);n.push(q,z,K)}}}else if(w||g)if(m)for(;null!==(e=u.exec(O))&&null===l.exec(O);){var W=parseFloat(e[1]),J=parseFloat(e[2]),Q=parseFloat(e[3]);s.push(W,J,Q)}else if(F)for(;null!==(e=u.exec(O))&&null===l.exec(O);){var X=parseFloat(e[1]),Z=parseFloat(e[2]),$=parseFloat(e[3]);o.push(X,Z,$)}null!==A.exec(O)?(x=!0,c=!1,I=!1):null!==p.exec(O)?(x=!1,c=!0,I=!1):null!==d.exec(O)?(x=!1,c=!1,I=!0):null!==v.exec(O)?(w=!0,c=!1,x=!1,I=!1):null!==h.exec(O)?(g=!0,c=!1,x=!1,I=!1):null!==y.exec(O)?(m=!0,F=!1,c=!1,x=!1,I=!1):null!==b.exec(O)&&(F=!0,m=!1,c=!1,x=!1,I=!1)}var tt=new a.BufferGeometry;if(tt.setIndex(n),tt.setAttribute("position",new r.Float32BufferAttribute(i,3)),o.length===i.length&&tt.setAttribute("normal",new r.Float32BufferAttribute(o,3)),s.length!==n.length)s.length===i.length&&tt.setAttribute("color",new r.Float32BufferAttribute(s,3));else{var et=(tt=tt.toNonIndexed()).attributes.position.count/3;if(s.length===3*et){for(var rt=[],at=0;at<et;at++){var nt=s[3*at+0],it=s[3*at+1],st=s[3*at+2];rt.push(nt,it,st),rt.push(nt,it,st),rt.push(nt,it,st)}tt.setAttribute("color",new r.Float32BufferAttribute(rt,3))}}return tt}(s.LoaderUtils.decodeText(t)):function(t){var e,n,i=new Uint8Array(t),s=new DataView(t),o=[],l=[],u=[],f=0;function p(t,e){for(var r=e,a=t[r],n=[];10!==a;)n.push(String.fromCharCode(a)),a=t[++r];return{start:e,end:r,next:r+1,parsedString:n.join("")}}for(;;){if(0===(n=(e=p(i,f)).parsedString).indexOf("DATASET")){var A=n.split(" ")[1];if("POLYDATA"!==A)throw new Error("Unsupported DATASET type: "+A)}else if(0===n.indexOf("POINTS")){var d=parseInt(n.split(" ")[1],10),v=4*d*3;o=new Float32Array(3*d);for(var h=e.next,y=0;y<d;y++)o[3*y]=s.getFloat32(h,!1),o[3*y+1]=s.getFloat32(h+4,!1),o[3*y+2]=s.getFloat32(h+8,!1),h+=12;e.next=e.next+v+1}else if(0===n.indexOf("TRIANGLE_STRIPS")){var b=parseInt(n.split(" ")[1],10),c=parseInt(n.split(" ")[2],10),x=4*c;u=new Uint32Array(3*c-9*b);for(var I=0,w=e.next,g=0;g<b;g++){var m=s.getInt32(w,!1),F=[];w+=4;for(var D=0;D<m;D++)F.push(s.getInt32(w,!1)),w+=4;for(var T=0;T<m-2;T++)T%2?(u[I++]=F[T],u[I++]=F[T+2],u[I++]=F[T+1]):(u[I++]=F[T],u[I++]=F[T+1],u[I++]=F[T+2])}e.next=e.next+x+1}else if(0===n.indexOf("POLYGONS")){var O=parseInt(n.split(" ")[1],10),P=parseInt(n.split(" ")[2],10),S=4*P;u=new Uint32Array(3*P-9*O);for(var C=0,L=e.next,N=0;N<O;N++){var U=s.getInt32(L,!1),B=[];L+=4;for(var E=0;E<U;E++)B.push(s.getInt32(L,!1)),L+=4;for(var _=1;_<U-1;_++)u[C++]=B[0],u[C++]=B[_],u[C++]=B[_+1]}e.next=e.next+S+1}else if(0===n.indexOf("POINT_DATA")){var R=parseInt(n.split(" ")[1],10);e=p(i,e.next);var G=4*R*3;l=new Float32Array(3*R);for(var k=e.next,V=0;V<R;V++)l[3*V]=s.getFloat32(k,!1),l[3*V+1]=s.getFloat32(k+4,!1),l[3*V+2]=s.getFloat32(k+8,!1),k+=12;e.next=e.next+G}if((f=e.next)>=i.byteLength)break}var Y=new a.BufferGeometry;return Y.setIndex(new r.BufferAttribute(u,1)),Y.setAttribute("position",new r.BufferAttribute(o,3)),l.length===o.length&&Y.setAttribute("normal",new r.BufferAttribute(l,3)),Y}(t)},i}(i.Loader);t.VTKLoader=l,Object.defineProperty(t,"__esModule",{value:!0})}));
