/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","../core/BufferGeometry","../math/Euler","./FileLoader","../core/BufferAttribute","../objects/Group","../materials/LineBasicMaterial","../objects/LineSegments","./Loader"],(function(e,r,t,a,i,n,o,l,s,u){"use strict";var v=function(e){function u(r){var t;return(t=e.call(this,r)||this).splitLayer=!1,t}r.inheritsLoose(u,e);var v=u.prototype;return v.load=function(e,r,t,a){var n=this,o=new i.FileLoader(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(t){try{r(n.parse(t))}catch(r){a?a(r):console.error(r),n.manager.itemError(e)}}),t,a)},v.parse=function(e){var r={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},i=[],u=void 0,v=new l.LineBasicMaterial({color:16711680});v.name="path";var f=new l.LineBasicMaterial({color:65280});function d(e){u={vertex:[],pathVertex:[],z:e.z},i.push(u)}function p(e,t){return r.relative?t:t-e}function h(e,t){return r.relative?e+t:t}f.name="extruded";for(var c=e.replace(/;.+/g,"").split("\n"),x=function(e){var t,a,i=c[e].split(" "),n=i[0].toUpperCase(),o={};if(i.splice(1).forEach((function(e){if(void 0!==e[0]){var r=e[0].toLowerCase(),t=parseFloat(e.substring(1));o[r]=t}})),"G0"===n||"G1"===n){var l={x:void 0!==o.x?h(r.x,o.x):r.x,y:void 0!==o.y?h(r.y,o.y):r.y,z:void 0!==o.z?h(r.z,o.z):r.z,e:void 0!==o.e?h(r.e,o.e):r.e,f:void 0!==o.f?h(r.f,o.f):r.f};p(r.e,l.e)>0&&(r.extruding=p(r.e,l.e)>0,null!=u&&l.z==u.z||d(l)),t=r,a=l,void 0===u&&d(t),r.extruding?(u.vertex.push(t.x,t.y,t.z),u.vertex.push(a.x,a.y,a.z)):(u.pathVertex.push(t.x,t.y,t.z),u.pathVertex.push(a.x,a.y,a.z)),r=l}else if("G2"===n||"G3"===n);else if("G90"===n)r.relative=!1;else if("G91"===n)r.relative=!0;else if("G92"===n){var s=r;s.x=void 0!==o.x?o.x:s.x,s.y=void 0!==o.y?o.y:s.y,s.z=void 0!==o.z?o.z:s.z,s.e=void 0!==o.e?o.e:s.e}},y=0;y<c.length;y++)x(y);function g(e,r,a){var i=new t.BufferGeometry;i.setAttribute("position",new n.Float32BufferAttribute(e,3));var o=new s.LineSegments(i,r?f:v);o.name="layer"+a,z.add(o)}var z=new o.Group;if(z.name="gcode",this.splitLayer)for(var m=0;m<i.length;m++){var L=i[m];g(L.vertex,!0,m),g(L.pathVertex,!1,m)}else{for(var G=[],w=[],b=0;b<i.length;b++){for(var B=i[b],C=B.vertex,E=B.pathVertex,F=0;F<C.length;F++)G.push(C[F]);for(var M=0;M<E.length;M++)w.push(E[M])}g(G,!0,i.length),g(w,!1,i.length)}return z.quaternion.setFromEuler(new a.Euler(-Math.PI/2,0,0)),z},u}(u.Loader);e.GCodeLoader=v,Object.defineProperty(e,"__esModule",{value:!0})}));
