/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","../math/Box2","../core/BufferGeometry","./FileLoader","../core/BufferAttribute","./Loader","../math/Matrix3","../extras/core/Path","../extras/core/Shape","../extras/core/ShapePath","../extras/ShapeUtils","../math/Vector3","../math/Vector2"],(function(t,e,r,n,i,a,o,s,c,u,l,f,y,h){"use strict";var p=function(t){function o(e){var r;return(r=t.call(this,e)||this).defaultDPI=90,r.defaultUnit="px",r}e.inheritsLoose(o,t);var p=o.prototype;return p.load=function(t,e,r,n){var a=this,o=new i.FileLoader(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,(function(r){try{e(a.parse(r))}catch(e){n?n(e):console.error(e),a.manager.itemError(t)}}),r,n)},p.parse=function(t){var e=this;function r(t,e,r,i,a,o,s,c){if(0!=e&&0!=r){i=i*Math.PI/180,e=Math.abs(e),r=Math.abs(r);var u=(s.x-c.x)/2,l=(s.y-c.y)/2,f=Math.cos(i)*u+Math.sin(i)*l,y=-Math.sin(i)*u+Math.cos(i)*l,h=e*e,p=r*r,v=f*f,x=y*y,d=v/h+x/p;if(d>1){var b=Math.sqrt(d);h=(e*=b)*e,p=(r*=b)*r}var g=h*x+p*v,m=(h*p-g)/g,w=Math.sqrt(Math.max(0,m));a===o&&(w=-w);var A=w*e*y/r,k=-w*r*f/e,M=Math.cos(i)*A-Math.sin(i)*k+(s.x+c.x)/2,P=Math.sin(i)*A+Math.cos(i)*k+(s.y+c.y)/2,T=n(1,0,(f-A)/e,(y-k)/r),S=n((f-A)/e,(y-k)/r,(-f-A)/e,(-y-k)/r)%(2*Math.PI);t.currentPath.absellipse(M,P,e,r,T,T+S,0===o,i)}else t.lineTo(c.x,c.y)}function n(t,e,r,n){var i=t*r+e*n,a=Math.sqrt(t*t+e*e)*Math.sqrt(r*r+n*n),o=Math.acos(Math.max(-1,Math.min(1,i/a)));return t*n-e*r<0&&(o=-o),o}function i(t,e){e=Object.assign({},e);var r={};if(t.hasAttribute("class"))for(var n=t.getAttribute("class").split(/\s/).filter(Boolean).map((function(t){return t.trim()})),i=0;i<n.length;i++)r=Object.assign(r,b["."+n[i]]);function a(n,i,a){void 0===a&&(a=function(t){return t.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),t}),t.hasAttribute(n)&&(e[i]=a(t.getAttribute(n))),r[n]&&(e[i]=a(r[n])),t.style&&""!==t.style[n]&&(e[i]=a(t.style[n]))}function o(t){return Math.max(0,Math.min(1,p(t)))}function s(t){return Math.max(0,p(t))}return t.hasAttribute("id")&&(r=Object.assign(r,b["#"+t.getAttribute("id")])),a("fill","fill"),a("fill-opacity","fillOpacity",o),a("fill-rule","fillRule"),a("opacity","opacity",o),a("stroke","stroke"),a("stroke-opacity","strokeOpacity",o),a("stroke-width","strokeWidth",s),a("stroke-linejoin","strokeLineJoin"),a("stroke-linecap","strokeLineCap"),a("stroke-miterlimit","strokeMiterLimit",s),a("visibility","visibility"),e}function a(t,e){return t-(e-t)}function o(t,e,r){if("string"!=typeof t)throw new TypeError("Invalid input: "+typeof t);var n,i={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},a=0,o=!0,s="",c="",u=[];function l(t,e,r){var n=new SyntaxError('Unexpected character "'+t+'" at index '+e+".");throw n.partial=r,n}function f(){""!==s&&(""===c?u.push(Number(s)):u.push(Number(s)*Math.pow(10,Number(c)))),s="",c=""}for(var y=t.length,h=0;h<y;h++)if(n=t[h],Array.isArray(e)&&e.includes(u.length%r)&&i.FLAGS.test(n))a=1,s=n,f();else{if(0===a){if(i.WHITESPACE.test(n))continue;if(i.DIGIT.test(n)||i.SIGN.test(n)){a=1,s=n;continue}if(i.POINT.test(n)){a=2,s=n;continue}i.COMMA.test(n)&&(o&&l(n,h,u),o=!0)}if(1===a){if(i.DIGIT.test(n)){s+=n;continue}if(i.POINT.test(n)){s+=n,a=2;continue}if(i.EXP.test(n)){a=3;continue}i.SIGN.test(n)&&1===s.length&&i.SIGN.test(s[0])&&l(n,h,u)}if(2===a){if(i.DIGIT.test(n)){s+=n;continue}if(i.EXP.test(n)){a=3;continue}i.POINT.test(n)&&"."===s[s.length-1]&&l(n,h,u)}if(3===a){if(i.DIGIT.test(n)){c+=n;continue}if(i.SIGN.test(n)){if(""===c){c+=n;continue}1===c.length&&i.SIGN.test(c)&&l(n,h,u)}}i.WHITESPACE.test(n)?(f(),a=0,o=!1):i.COMMA.test(n)?(f(),a=0,o=!0):i.SIGN.test(n)?(f(),a=1,s=n):i.POINT.test(n)?(f(),a=2,s=n):l(n,h,u)}return f(),u}var u=["mm","cm","in","pt","pc","px"],f={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function p(t){var r="px";if("string"==typeof t||t instanceof String)for(var n=0,i=u.length;n<i;n++){var a=u[n];if(t.endsWith(a)){r=a,t=t.substring(0,t.length-a.length);break}}var o=void 0;return"px"===r&&"px"!==e.defaultUnit?o=f.in[e.defaultUnit]/e.defaultDPI:(o=f[r][e.defaultUnit])<0&&(o=f[r].in*e.defaultDPI),o*parseFloat(t)}function v(t){var e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function x(t){var e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}var d=[],b={},g=[],m=new s.Matrix3,w=new s.Matrix3,A=new s.Matrix3,k=new s.Matrix3,M=new h.Vector2,P=new y.Vector3,T=new s.Matrix3,S=(new DOMParser).parseFromString(t,"image/svg+xml");return function t(e,n){if(1===e.nodeType){var u=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;var e=function(t){var e=new s.Matrix3,r=m;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){var n=p(t.getAttribute("x")),i=p(t.getAttribute("y"));e.translate(n,i)}if(t.hasAttribute("transform"))for(var a=t.getAttribute("transform").split(")"),c=a.length-1;c>=0;c--){var u=a[c].trim();if(""!==u){var l=u.indexOf("("),f=u.length;if(l>0&&l<f){var y=u.slice(0,l),h=o(u.slice(l+1));switch(r.identity(),y){case"translate":if(h.length>=1){var v=h[0],x=v;h.length>=2&&(x=h[1]),r.translate(v,x)}break;case"rotate":if(h.length>=1){var d=0,b=0,g=0;d=-h[0]*Math.PI/180,h.length>=3&&(b=h[1],g=h[2]),w.identity().translate(-b,-g),A.identity().rotate(d),k.multiplyMatrices(A,w),w.identity().translate(b,g),r.multiplyMatrices(w,k)}break;case"scale":if(h.length>=1){var M=h[0],P=M;h.length>=2&&(P=h[1]),r.scale(M,P)}break;case"skewX":1===h.length&&r.set(1,Math.tan(h[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===h.length&&r.set(1,0,0,Math.tan(h[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===h.length&&r.set(h[0],h[2],h[4],h[1],h[3],h[5],0,0,1)}}e.premultiply(r)}}return e}(t);g.length>0&&e.premultiply(g[g.length-1]);return T.copy(e),g.push(e),e}(e),f=!1,y=null;switch(e.nodeName){case"svg":break;case"style":!function(t){if(!t.sheet||!t.sheet.cssRules||!t.sheet.cssRules.length)return;for(var e=0;e<t.sheet.cssRules.length;e++){var r=t.sheet.cssRules[e];if(1===r.type)for(var n=r.selectorText.split(/,/gm).filter(Boolean).map((function(t){return t.trim()})),i=0;i<n.length;i++){var a=Object.fromEntries(Object.entries(r.style).filter((function(t){return""!==t[1]})));b[n[i]]=Object.assign(b[n[i]]||{},a)}}}(e);break;case"g":n=i(e,n);break;case"path":n=i(e,n),e.hasAttribute("d")&&(y=function(t){for(var e=new l.ShapePath,n=new h.Vector2,i=new h.Vector2,s=new h.Vector2,c=!0,u=!1,f=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),y=0,p=f.length;y<p;y++){var v=f[y],x=v.charAt(0),d=v.slice(1).trim();!0===c&&(u=!0,c=!1);var b=void 0;switch(x){case"M":for(var g=0,m=(b=o(d)).length;g<m;g+=2)n.x=b[g+0],n.y=b[g+1],i.x=n.x,i.y=n.y,0===g?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),0===g&&s.copy(n);break;case"H":for(var w=0,A=(b=o(d)).length;w<A;w++)n.x=b[w],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===w&&!0===u&&s.copy(n);break;case"V":for(var k=0,M=(b=o(d)).length;k<M;k++)n.y=b[k],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===k&&!0===u&&s.copy(n);break;case"L":for(var P=0,T=(b=o(d)).length;P<T;P+=2)n.x=b[P+0],n.y=b[P+1],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===P&&!0===u&&s.copy(n);break;case"C":for(var S=0,V=(b=o(d)).length;S<V;S+=6)e.bezierCurveTo(b[S+0],b[S+1],b[S+2],b[S+3],b[S+4],b[S+5]),i.x=b[S+2],i.y=b[S+3],n.x=b[S+4],n.y=b[S+5],0===S&&!0===u&&s.copy(n);break;case"S":for(var C=0,I=(b=o(d)).length;C<I;C+=4)e.bezierCurveTo(a(n.x,i.x),a(n.y,i.y),b[C+0],b[C+1],b[C+2],b[C+3]),i.x=b[C+0],i.y=b[C+1],n.x=b[C+2],n.y=b[C+3],0===C&&!0===u&&s.copy(n);break;case"Q":for(var L=0,N=(b=o(d)).length;L<N;L+=4)e.quadraticCurveTo(b[L+0],b[L+1],b[L+2],b[L+3]),i.x=b[L+0],i.y=b[L+1],n.x=b[L+2],n.y=b[L+3],0===L&&!0===u&&s.copy(n);break;case"T":for(var E=0,O=(b=o(d)).length;E<O;E+=2){var B=a(n.x,i.x),G=a(n.y,i.y);e.quadraticCurveTo(B,G,b[E+0],b[E+1]),i.x=B,i.y=G,n.x=b[E+0],n.y=b[E+1],0===E&&!0===u&&s.copy(n)}break;case"A":for(var z=0,W=(b=o(d,[3,4],7)).length;z<W;z+=7)if(b[z+5]!=n.x||b[z+6]!=n.y){var q=n.clone();n.x=b[z+5],n.y=b[z+6],i.x=n.x,i.y=n.y,r(e,b[z],b[z+1],b[z+2],b[z+3],b[z+4],q,n),0===z&&!0===u&&s.copy(n)}break;case"m":for(var D=0,H=(b=o(d)).length;D<H;D+=2)n.x+=b[D+0],n.y+=b[D+1],i.x=n.x,i.y=n.y,0===D?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),0===D&&s.copy(n);break;case"h":for(var R=0,F=(b=o(d)).length;R<F;R++)n.x+=b[R],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===R&&!0===u&&s.copy(n);break;case"v":for(var j=0,U=(b=o(d)).length;j<U;j++)n.y+=b[j],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===j&&!0===u&&s.copy(n);break;case"l":for(var X=0,J=(b=o(d)).length;X<J;X+=2)n.x+=b[X+0],n.y+=b[X+1],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===X&&!0===u&&s.copy(n);break;case"c":for(var _=0,Y=(b=o(d)).length;_<Y;_+=6)e.bezierCurveTo(n.x+b[_+0],n.y+b[_+1],n.x+b[_+2],n.y+b[_+3],n.x+b[_+4],n.y+b[_+5]),i.x=n.x+b[_+2],i.y=n.y+b[_+3],n.x+=b[_+4],n.y+=b[_+5],0===_&&!0===u&&s.copy(n);break;case"s":for(var Q=0,Z=(b=o(d)).length;Q<Z;Q+=4)e.bezierCurveTo(a(n.x,i.x),a(n.y,i.y),n.x+b[Q+0],n.y+b[Q+1],n.x+b[Q+2],n.y+b[Q+3]),i.x=n.x+b[Q+0],i.y=n.y+b[Q+1],n.x+=b[Q+2],n.y+=b[Q+3],0===Q&&!0===u&&s.copy(n);break;case"q":for(var K=0,$=(b=o(d)).length;K<$;K+=4)e.quadraticCurveTo(n.x+b[K+0],n.y+b[K+1],n.x+b[K+2],n.y+b[K+3]),i.x=n.x+b[K+0],i.y=n.y+b[K+1],n.x+=b[K+2],n.y+=b[K+3],0===K&&!0===u&&s.copy(n);break;case"t":for(var tt=0,et=(b=o(d)).length;tt<et;tt+=2){var rt=a(n.x,i.x),nt=a(n.y,i.y);e.quadraticCurveTo(rt,nt,n.x+b[tt+0],n.y+b[tt+1]),i.x=rt,i.y=nt,n.x=n.x+b[tt+0],n.y=n.y+b[tt+1],0===tt&&!0===u&&s.copy(n)}break;case"a":for(var it=0,at=(b=o(d,[3,4],7)).length;it<at;it+=7)if(0!=b[it+5]||0!=b[it+6]){var ot=n.clone();n.x+=b[it+5],n.y+=b[it+6],i.x=n.x,i.y=n.y,r(e,b[it],b[it+1],b[it+2],b[it+3],b[it+4],ot,n),0===it&&!0===u&&s.copy(n)}break;case"Z":case"z":e.currentPath.autoClose=!0,e.currentPath.curves.length>0&&(n.copy(s),e.currentPath.currentPoint.copy(n),c=!0);break;default:console.warn(v)}u=!1}return e}(e));break;case"rect":n=i(e,n),y=function(t){var e=p(t.getAttribute("x")||0),r=p(t.getAttribute("y")||0),n=p(t.getAttribute("rx")||t.getAttribute("ry")||0),i=p(t.getAttribute("ry")||t.getAttribute("rx")||0),a=p(t.getAttribute("width")),o=p(t.getAttribute("height")),s=.448084975506,c=new l.ShapePath;c.moveTo(e+n,r),c.lineTo(e+a-n,r),(0!==n||0!==i)&&c.bezierCurveTo(e+a-n*s,r,e+a,r+i*s,e+a,r+i);c.lineTo(e+a,r+o-i),(0!==n||0!==i)&&c.bezierCurveTo(e+a,r+o-i*s,e+a-n*s,r+o,e+a-n,r+o);c.lineTo(e+n,r+o),(0!==n||0!==i)&&c.bezierCurveTo(e+n*s,r+o,e,r+o-i*s,e,r+o-i);c.lineTo(e,r+i),(0!==n||0!==i)&&c.bezierCurveTo(e,r+i*s,e+n*s,r,e+n,r);return c}(e);break;case"polygon":n=i(e,n),y=function(t){function e(t,e,r){var a=p(e),o=p(r);0===i?n.moveTo(a,o):n.lineTo(a,o),i++}var r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new l.ShapePath,i=0;return t.getAttribute("points").replace(r,e),n.currentPath.autoClose=!0,n}(e);break;case"polyline":n=i(e,n),y=function(t){function e(t,e,r){var a=p(e),o=p(r);0===i?n.moveTo(a,o):n.lineTo(a,o),i++}var r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new l.ShapePath,i=0;return t.getAttribute("points").replace(r,e),n.currentPath.autoClose=!1,n}(e);break;case"circle":n=i(e,n),y=function(t){var e=p(t.getAttribute("cx")||0),r=p(t.getAttribute("cy")||0),n=p(t.getAttribute("r")||0),i=new c.Path;i.absarc(e,r,n,0,2*Math.PI);var a=new l.ShapePath;return a.subPaths.push(i),a}(e);break;case"ellipse":n=i(e,n),y=function(t){var e=p(t.getAttribute("cx")||0),r=p(t.getAttribute("cy")||0),n=p(t.getAttribute("rx")||0),i=p(t.getAttribute("ry")||0),a=new c.Path;a.absellipse(e,r,n,i,0,2*Math.PI);var o=new l.ShapePath;return o.subPaths.push(a),o}(e);break;case"line":n=i(e,n),y=function(t){var e=p(t.getAttribute("x1")||0),r=p(t.getAttribute("y1")||0),n=p(t.getAttribute("x2")||0),i=p(t.getAttribute("y2")||0),a=new l.ShapePath;return a.moveTo(e,r),a.lineTo(n,i),a.currentPath.autoClose=!1,a}(e);break;case"defs":f=!0;break;case"use":n=i(e,n);var S=(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),V=e.viewportElement.getElementById(S);V?t(V,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+S)}y&&(void 0!==n.fill&&"none"!==n.fill&&y.color.setStyle(n.fill),function(t,e){function r(t){P.set(t.x,t.y,1).applyMatrix3(e),t.set(P.x,P.y)}for(var n=function(t){return 0!==t.elements[1]||0!==t.elements[3]}(e),i=t.subPaths,a=0,o=i.length;a<o;a++)for(var s=i[a].curves,c=0;c<s.length;c++){var u=s[c];u.isLineCurve?(r(u.v1),r(u.v2)):u.isCubicBezierCurve?(r(u.v0),r(u.v1),r(u.v2),r(u.v3)):u.isQuadraticBezierCurve?(r(u.v0),r(u.v1),r(u.v2)):u.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),M.set(u.aX,u.aY),r(M),u.aX=M.x,u.aY=M.y,u.xRadius*=v(e),u.yRadius*=x(e))}}(y,T),d.push(y),y.userData={node:e,style:n});for(var C=e.childNodes,I=0;I<C.length;I++){var L=C[I];f&&"style"!==L.nodeName&&"defs"!==L.nodeName||t(L,n)}u&&(g.pop(),g.length>0?T.copy(g[g.length-1]):T.identity())}}(S.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:d,xml:S.documentElement}},o.createShapes=function(t){var e=999999999,n=0,i=1,a=2,o=3,s=4,l=5,y=6,p={loc:n,t:0};function v(t,e,r,i){var o=t.x,s=e.x,c=r.x,u=i.x,l=t.y,f=e.y,y=r.y,h=i.y,v=(u-c)*(l-y)-(h-y)*(o-c),d=(h-y)*(s-o)-(u-c)*(f-l),b=v/d,g=((s-o)*(l-y)-(f-l)*(o-c))/d;if(0===d&&0!==v||b<=0||b>=1||g<0||g>1)return null;if(0===v&&0===d){for(var m=0;m<2;m++){if(x(0===m?r:i,t,e),p.loc==n){var w=0===m?r:i;return{x:w.x,y:w.y,t:p.t}}if(p.loc==a)return{x:+(o+p.t*(s-o)).toPrecision(10),y:+(l+p.t*(f-l)).toPrecision(10),t:p.t}}return null}for(var A=0;A<2;A++)if(x(0===A?r:i,t,e),p.loc==n){var k=0===A?r:i;return{x:k.x,y:k.y,t:p.t}}return{x:+(o+b*(s-o)).toPrecision(10),y:+(l+b*(f-l)).toPrecision(10),t:b}}function x(t,e,r){var c,u=r.x-e.x,f=r.y-e.y,h=t.x-e.x,v=t.y-e.y,x=u*v-h*f;if(t.x===e.x&&t.y===e.y)return p.loc=n,void(p.t=0);if(t.x===r.x&&t.y===r.y)return p.loc=i,void(p.t=1);x<-Number.EPSILON?p.loc=o:x>Number.EPSILON?p.loc=s:u*h<0||f*v<0?p.loc=l:Math.sqrt(u*u+f*f)<Math.sqrt(h*h+v*v)?p.loc=y:(c=0!==u?h/u:v/f,p.loc=a,p.t=c)}function d(t,e,r){var n=new h.Vector2;e.getCenter(n);var i=[];return r.forEach((function(e){e.boundingBox.containsPoint(n)&&function(t,e){for(var r=[],n=[],i=1;i<t.length;i++)for(var a=t[i-1],o=t[i],s=function(t){var i=e[t-1],s=e[t],c=v(a,o,i,s);null!==c&&void 0===r.find((function(t){return t.t<=c.t+Number.EPSILON&&t.t>=c.t-Number.EPSILON}))&&(r.push(c),n.push(new h.Vector2(c.x,c.y)))},c=1;c<e.length;c++)s(c);return n}(t,e.points).forEach((function(t){i.push({identifier:e.identifier,isCW:e.isCW,point:t})}))})),i.sort((function(t,e){return t.point.x-e.point.x})),i}var b=0,g=e,m=-999999999,w=t.subPaths.map((function(t){for(var n=t.getPoints(),i=-999999999,a=e,o=-999999999,s=e,c=0;c<n.length;c++){var u=n[c];u.y>i&&(i=u.y),u.y<a&&(a=u.y),u.x>o&&(o=u.x),u.x<s&&(s=u.x)}return m<=o&&(m=o+1),g>=s&&(g=s-1),{curves:t.curves,points:n,isCW:f.ShapeUtils.isClockWise(n),identifier:b++,boundingBox:new r.Box2(new h.Vector2(s,a),new h.Vector2(o,i))}})),A=(w=w.filter((function(t){return t.points.length>1}))).map((function(e){return function(t,e,r,n,i){null!=i&&""!==i||(i="nonzero");var a=new h.Vector2;t.boundingBox.getCenter(a);var o=d([new h.Vector2(r,a.y),new h.Vector2(n,a.y)],t.boundingBox,e);o.sort((function(t,e){return t.point.x-e.point.x}));var s=[],c=[];o.forEach((function(e){e.identifier===t.identifier?s.push(e):c.push(e)}));for(var u=s[0].point.x,l=[],f=0;f<c.length&&c[f].point.x<u;)l.length>0&&l[l.length-1]===c[f].identifier?l.pop():l.push(c[f].identifier),f++;if(l.push(t.identifier),"evenodd"===i){var y=l.length%2==0,p=l[l.length-2];return{identifier:t.identifier,isHole:y,for:p}}if("nonzero"===i){for(var v=!0,x=null,b=null,g=0;g<l.length;g++){var m=l[g];v?(b=e[m].isCW,v=!1,x=m):b!==e[m].isCW&&(b=e[m].isCW,v=!0)}return{identifier:t.identifier,isHole:v,for:x}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}(e,w,g,m,t.userData.style.fillRule)})),k=[];return w.forEach((function(t){if(!A[t.identifier].isHole){var e=new u.Shape;e.curves=t.curves,A.filter((function(e){return e.isHole&&e.for===t.identifier})).forEach((function(t){var r=w[t.identifier],n=new c.Path;n.curves=r.curves,e.holes.push(n)})),k.push(e)}})),k},o.getStrokeStyle=function(t,e,r,n,i){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:i=void 0!==i?i:4}},o.pointsToStroke=function(t,e,r,i){var s=[],c=[],u=[];if(0===o.pointsToStrokeWithBuffers(t,e,r,i,s,c,u))return null;var l=new n.BufferGeometry;return l.setAttribute("position",new a.Float32BufferAttribute(s,3)),l.setAttribute("normal",new a.Float32BufferAttribute(c,3)),l.setAttribute("uv",new a.Float32BufferAttribute(u,2)),l},o.pointsToStrokeWithBuffers=function(t,e,r,n,i,a,o,s){var c=new h.Vector2,u=new h.Vector2,l=new h.Vector2,f=new h.Vector2,y=new h.Vector2,p=new h.Vector2,v=new h.Vector2,x=new h.Vector2,d=new h.Vector2,b=new h.Vector2,g=new h.Vector2,m=new h.Vector2,w=new h.Vector2,A=new h.Vector2,k=new h.Vector2,M=new h.Vector2,P=new h.Vector2;r=void 0!==r?r:12,n=void 0!==n?n:.001,s=void 0!==s?s:0;var T=(t=function(t){for(var e=!1,r=1,i=t.length-1;r<i;r++)if(t[r].distanceTo(t[r+1])<n){e=!0;break}if(!e)return t;var a=[];a.push(t[0]);for(var o=1,s=t.length-1;o<s;o++)t[o].distanceTo(t[o+1])>=n&&a.push(t[o]);return a.push(t[t.length-1]),a}(t)).length;if(T<2)return 0;var S,V,C,I,L,N,E=t[0].equals(t[T-1]),O=t[0],B=e.strokeWidth/2,G=1/(T-1),z=0,W=!1,q=0,D=3*s,H=2*s;K(t[0],t[1],c).multiplyScalar(B),x.copy(t[0]).sub(c),d.copy(t[0]).add(c),b.copy(x),g.copy(d);for(var R=1;R<T;R++){S=t[R],V=R===T-1?E?t[1]:void 0:t[R+1];var F=c;if(K(O,S,F),l.copy(F).multiplyScalar(B),m.copy(S).sub(l),w.copy(S).add(l),C=z+G,I=!1,void 0!==V){K(S,V,u),l.copy(u).multiplyScalar(B),A.copy(S).sub(l),k.copy(S).add(l),L=!0,l.subVectors(V,O),F.dot(l)<0&&(L=!1),1===R&&(W=L),l.subVectors(V,S),l.normalize();var j=Math.abs(F.dot(l));if(0!==j){var U=B/j;l.multiplyScalar(-U),f.subVectors(S,O),y.copy(f).setLength(U).add(l),M.copy(y).negate();var X=y.length(),J=f.length();f.divideScalar(J),p.subVectors(V,S);var _=p.length();switch(p.divideScalar(_),f.dot(M)<J&&p.dot(M)<_&&(I=!0),P.copy(y).add(S),M.add(S),N=!1,I?L?(k.copy(M),w.copy(M)):(A.copy(M),m.copy(M)):et(),e.strokeLineJoin){case"bevel":rt(L,I,C);break;case"round":nt(L,I),L?tt(S,m,A,C,0):tt(S,k,w,C,1);break;default:var Y=B*e.strokeMiterLimit/X;if(Y<1){if("miter-clip"!==e.strokeLineJoin){rt(L,I,C);break}nt(L,I),L?(p.subVectors(P,m).multiplyScalar(Y).add(m),v.subVectors(P,A).multiplyScalar(Y).add(A),$(m,C,0),$(p,C,0),$(S,C,.5),$(S,C,.5),$(p,C,0),$(v,C,0),$(S,C,.5),$(v,C,0),$(A,C,0)):(p.subVectors(P,w).multiplyScalar(Y).add(w),v.subVectors(P,k).multiplyScalar(Y).add(k),$(w,C,1),$(p,C,1),$(S,C,.5),$(S,C,.5),$(p,C,1),$(v,C,1),$(S,C,.5),$(v,C,1),$(k,C,1))}else I?(L?($(d,z,1),$(x,z,0),$(P,C,0),$(d,z,1),$(P,C,0),$(M,C,1)):($(d,z,1),$(x,z,0),$(P,C,1),$(x,z,0),$(M,C,0),$(P,C,1)),L?A.copy(P):k.copy(P)):L?($(m,C,0),$(P,C,0),$(S,C,.5),$(S,C,.5),$(P,C,0),$(A,C,0)):($(w,C,1),$(P,C,1),$(S,C,.5),$(S,C,.5),$(P,C,1),$(k,C,1)),N=!0}}else et()}else et();E||R!==T-1||it(t[0],b,g,L,!0,z),z=C,O=S,x.copy(A),d.copy(k)}if(E){if(I&&i){var Q=P,Z=M;W!==L&&(Q=M,Z=P),L?(N||W)&&(Z.toArray(i,0),Z.toArray(i,9),N&&Q.toArray(i,3)):!N&&W||(Z.toArray(i,3),Z.toArray(i,9),N&&Q.toArray(i,0))}}else it(S,m,w,L,!1,C);return q;function K(t,e,r){return r.subVectors(e,t),r.set(-r.y,r.x).normalize()}function $(t,e,r){i&&(i[D]=t.x,i[D+1]=t.y,i[D+2]=0,a&&(a[D]=0,a[D+1]=0,a[D+2]=1),D+=3,o&&(o[H]=e,o[H+1]=r,H+=2)),q+=3}function tt(t,e,n,i,a){c.copy(e).sub(t).normalize(),u.copy(n).sub(t).normalize();var o=Math.PI,s=c.dot(u);Math.abs(s)<1&&(o=Math.abs(Math.acos(s))),o/=r,l.copy(e);for(var y=0,h=r-1;y<h;y++)f.copy(l).rotateAround(t,o),$(l,i,a),$(f,i,a),$(t,i,.5),l.copy(f);$(f,i,a),$(n,i,a),$(t,i,.5)}function et(){$(d,z,1),$(x,z,0),$(m,C,0),$(d,z,1),$(m,C,1),$(w,C,0)}function rt(t,e,r){e?t?($(d,z,1),$(x,z,0),$(m,C,0),$(d,z,1),$(m,C,0),$(M,C,1),$(m,r,0),$(A,r,0),$(M,r,.5)):($(d,z,1),$(x,z,0),$(w,C,1),$(x,z,0),$(M,C,0),$(w,C,1),$(w,r,1),$(k,r,0),$(M,r,.5)):t?($(m,r,0),$(A,r,0),$(S,r,.5)):($(w,r,1),$(k,r,0),$(S,r,.5))}function nt(t,e){e&&(t?($(d,z,1),$(x,z,0),$(m,C,0),$(d,z,1),$(m,C,0),$(M,C,1),$(m,z,0),$(S,C,.5),$(M,C,1),$(S,C,.5),$(A,z,0),$(M,C,1)):($(d,z,1),$(x,z,0),$(w,C,1),$(x,z,0),$(M,C,0),$(w,C,1),$(w,z,1),$(M,C,0),$(S,C,.5),$(S,C,.5),$(M,C,0),$(k,z,1)))}function it(t,r,n,a,o,s){switch(e.strokeLineCap){case"round":o?tt(t,n,r,s,.5):tt(t,r,n,s,.5);break;case"square":if(o)c.subVectors(r,t),u.set(c.y,-c.x),l.addVectors(c,u).add(t),f.subVectors(u,c).add(t),a?(l.toArray(i,3),f.toArray(i,0),f.toArray(i,9)):(l.toArray(i,3),l.toArray(i,9),f.toArray(i,0));else{c.subVectors(n,t),u.set(c.y,-c.x),l.addVectors(c,u).add(t),f.subVectors(u,c).add(t);var y=i.length;a?(l.toArray(i,y-3),f.toArray(i,y-6),f.toArray(i,y-12)):(l.toArray(i,y-6),f.toArray(i,y-3),f.toArray(i,y-12))}}}},o}(o.Loader);t.SVGLoader=p,Object.defineProperty(t,"__esModule",{value:!0})}));
