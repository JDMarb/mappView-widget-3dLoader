/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","../constants","../core/InstancedBufferAttribute","../math/Color","../core/Object3D","../objects/Group","../objects/InstancedMesh","../objects/Sprite","../objects/Points","../objects/Line","../objects/LineLoop","../objects/LineSegments","../objects/LOD","../objects/Mesh","../objects/SkinnedMesh","../objects/Bone","../objects/Skeleton","../extras/core/Shape","../scenes/Fog","../scenes/FogExp2","../lights/HemisphereLight","../lights/SpotLight","../lights/PointLight","../lights/DirectionalLight","../lights/AmbientLight","../lights/RectAreaLight","../lights/LightProbe","../cameras/OrthographicCamera","../cameras/PerspectiveCamera","../scenes/Scene","../textures/CubeTexture","../textures/Texture","../textures/Source","../textures/DataTexture","./ImageLoader","./LoadingManager","../animation/AnimationClip","./MaterialLoader","./LoaderUtils","./BufferGeometryLoader","./Loader","./FileLoader","../geometries/Geometries","../utils"],(function(e,r,t,a,i,n,o,s,u,d,c,p,l,h,m,g,f,v,b,w,y,L,k,x,M,A,S,O,E,R,j,T,C,F,P,U,H,D,G,B,I,N,q,z,W){"use strict";var J=function(e){function t(r){return e.call(this,r)||this}r.inheritsLoose(t,e);var N=t.prototype;return N.load=function(e,r,t,a){var i=this,n=""===this.path?B.LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;var o=new q.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(t){var n=null;try{n=JSON.parse(t)}catch(r){return void 0!==a&&a(r),void console.error("THREE:ObjectLoader: Can't parse "+e+".",r.message)}var o=n.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(n,r):console.error("THREE.ObjectLoader: Can't load "+e)}),t,a)},N.loadAsync=function(){var e=r.asyncToGenerator(r.regeneratorRuntime().mark((function e(t,a){var i,n,o,s,u,d;return r.regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,n=""===this.path?B.LoaderUtils.extractUrlBase(t):this.path,this.resourcePath=this.resourcePath||n,(o=new q.FileLoader(this.manager)).setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),e.next=9,o.loadAsync(t,a);case 9:if(s=e.sent,u=JSON.parse(s),void 0!==(d=u.metadata)&&void 0!==d.type&&"geometry"!==d.type.toLowerCase()){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:return e.next=16,i.parseAsync(u);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}(),N.parse=function(e,r){var t=this.parseAnimations(e.animations),a=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,a),n=this.parseImages(e.images,(function(){void 0!==r&&r(u)})),o=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,i,s,o,t),d=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,d),void 0!==r){var c=!1;for(var p in n)if(n[p].data instanceof HTMLImageElement){c=!0;break}!1===c&&r(u)}return u},N.parseAsync=function(){var e=r.asyncToGenerator(r.regeneratorRuntime().mark((function e(t){var a,i,n,o,s,u,d,c;return r.regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),e.next=5,this.parseImagesAsync(t.images);case 5:return o=e.sent,s=this.parseTextures(t.textures,o),u=this.parseMaterials(t.materials,s),d=this.parseObject(t.object,n,u,s,a),c=this.parseSkeletons(t.skeletons,d),this.bindSkeletons(d,c),e.abrupt("return",d);case 12:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),N.parseShapes=function(e){var r={};if(void 0!==e)for(var t=0,a=e.length;t<a;t++){var i=(new b.Shape).fromJSON(e[t]);r[i.uuid]=i}return r},N.parseSkeletons=function(e,r){var t={},a={};if(r.traverse((function(e){e.isBone&&(a[e.uuid]=e)})),void 0!==e)for(var i=0,n=e.length;i<n;i++){var o=(new v.Skeleton).fromJSON(e[i],a);t[o.uuid]=o}return t},N.parseGeometries=function(e,r){var t={};if(void 0!==e)for(var a=new I.BufferGeometryLoader,i=0,n=e.length;i<n;i++){var o=void 0,s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=a.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in z?o=z[s.type].fromJSON(s,r):console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"')}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),t[s.uuid]=o}return t},N.parseMaterials=function(e,r){var t={},a={};if(void 0!==e){var i=new G.MaterialLoader;i.setTextures(r);for(var n=0,o=e.length;n<o;n++){var s=e[n];if("MultiMaterial"===s.type){for(var u=[],d=0;d<s.materials.length;d++){var c=s.materials[d];void 0===t[c.uuid]&&(t[c.uuid]=i.parse(c)),u.push(t[c.uuid])}a[s.uuid]=u}else void 0===t[s.uuid]&&(t[s.uuid]=i.parse(s)),a[s.uuid]=t[s.uuid]}}return a},N.parseAnimations=function(e){var r={};if(void 0!==e)for(var t=0;t<e.length;t++){var a=e[t],i=D.AnimationClip.parse(a);r[i.uuid]=i}return r},N.parseImages=function(e,r){var t,a=this,i={};function n(e){if("string"==typeof e){var r=e;return function(e){return a.manager.itemStart(e),t.load(e,(function(){a.manager.itemEnd(e)}),void 0,(function(){a.manager.itemError(e),a.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:a.resourcePath+r)}return e.data?{data:W.getTypedArray(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new H.LoadingManager(r);(t=new U.ImageLoader(o)).setCrossOrigin(this.crossOrigin);for(var s=0,u=e.length;s<u;s++){var d=e[s],c=d.url;if(Array.isArray(c)){for(var p=[],l=0,h=c.length;l<h;l++){var m=n(c[l]);null!==m&&(m instanceof HTMLImageElement?p.push(m):p.push(new P.DataTexture(m.data,m.width,m.height)))}i[d.uuid]=new F.Source(p)}else{var g=n(d.url);i[d.uuid]=new F.Source(g)}}}return i},N.parseImagesAsync=function(){var e=r.asyncToGenerator(r.regeneratorRuntime().mark((function e(t){var a,i,n,o,s,u,d,c,p,l,h,m,g,f,v;return r.regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(){return s=r.asyncToGenerator(r.regeneratorRuntime().mark((function e(t){var i,o;return r.regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=8;break}return o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i=t)?i:a.resourcePath+i,e.next=5,n.loadAsync(o);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:W.getTypedArray(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)},o=function(e){return s.apply(this,arguments)},a=this,i={},!(void 0!==t&&t.length>0)){e.next=33;break}(n=new U.ImageLoader(this.manager)).setCrossOrigin(this.crossOrigin),u=0,d=t.length;case 8:if(!(u<d)){e.next=33;break}if(c=t[u],p=c.url,!Array.isArray(p)){e.next=26;break}l=[],h=0,m=p.length;case 14:if(!(h<m)){e.next=23;break}return g=p[h],e.next=18,o(g);case 18:null!==(f=e.sent)&&(f instanceof HTMLImageElement?l.push(f):l.push(new P.DataTexture(f.data,f.width,f.height)));case 20:h++,e.next=14;break;case 23:i[c.uuid]=new F.Source(l),e.next=30;break;case 26:return e.next=28,o(c.url);case 28:v=e.sent,i[c.uuid]=new F.Source(v);case 30:u++,e.next=8;break;case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),N.parseTextures=function(e,r){function t(e,r){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),r[e])}var a={};if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var o=e[i];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===r[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=r[o.image],u=s.data,d=void 0;Array.isArray(u)?(d=new T.CubeTexture,6===u.length&&(d.needsUpdate=!0)):(d=u&&u.data?new P.DataTexture:new C.Texture,u&&(d.needsUpdate=!0)),d.source=s,d.uuid=o.uuid,void 0!==o.name&&(d.name=o.name),void 0!==o.mapping&&(d.mapping=t(o.mapping,V)),void 0!==o.offset&&d.offset.fromArray(o.offset),void 0!==o.repeat&&d.repeat.fromArray(o.repeat),void 0!==o.center&&d.center.fromArray(o.center),void 0!==o.rotation&&(d.rotation=o.rotation),void 0!==o.wrap&&(d.wrapS=t(o.wrap[0],_),d.wrapT=t(o.wrap[1],_)),void 0!==o.format&&(d.format=o.format),void 0!==o.type&&(d.type=o.type),void 0!==o.encoding&&(d.encoding=o.encoding),void 0!==o.minFilter&&(d.minFilter=t(o.minFilter,Y)),void 0!==o.magFilter&&(d.magFilter=t(o.magFilter,Y)),void 0!==o.anisotropy&&(d.anisotropy=o.anisotropy),void 0!==o.flipY&&(d.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(d.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(d.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(d.userData=o.userData),a[o.uuid]=d}return a},N.parseObject=function(e,r,t,v,b){var T,C,F;function P(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]}function U(e){if(void 0!==e){if(Array.isArray(e)){for(var r=[],a=0,i=e.length;a<i;a++){var n=e[a];void 0===t[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),r.push(t[n])}return r}return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),t[e]}}function H(e){return void 0===v[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),v[e]}switch(e.type){case"Scene":T=new j.Scene,void 0!==e.background&&(Number.isInteger(e.background)?T.background=new i.Color(e.background):T.background=H(e.background)),void 0!==e.environment&&(T.environment=H(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?T.fog=new w.Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(T.fog=new y.FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":T=new R.PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(T.focus=e.focus),void 0!==e.zoom&&(T.zoom=e.zoom),void 0!==e.filmGauge&&(T.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(T.filmOffset=e.filmOffset),void 0!==e.view&&(T.view=Object.assign({},e.view));break;case"OrthographicCamera":T=new E.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(T.zoom=e.zoom),void 0!==e.view&&(T.view=Object.assign({},e.view));break;case"AmbientLight":T=new A.AmbientLight(e.color,e.intensity);break;case"DirectionalLight":T=new M.DirectionalLight(e.color,e.intensity);break;case"PointLight":T=new x.PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":T=new S.RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":T=new k.SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":T=new L.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":T=(new O.LightProbe).fromJSON(e);break;case"SkinnedMesh":C=P(e.geometry),F=U(e.material),T=new g.SkinnedMesh(C,F),void 0!==e.bindMode&&(T.bindMode=e.bindMode),void 0!==e.bindMatrix&&T.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(T.skeleton=e.skeleton);break;case"Mesh":C=P(e.geometry),F=U(e.material),T=new m.Mesh(C,F);break;case"InstancedMesh":C=P(e.geometry),F=U(e.material);var D=e.count,G=e.instanceMatrix,B=e.instanceColor;(T=new s.InstancedMesh(C,F,D)).instanceMatrix=new a.InstancedBufferAttribute(new Float32Array(G.array),16),void 0!==B&&(T.instanceColor=new a.InstancedBufferAttribute(new Float32Array(B.array),B.itemSize));break;case"LOD":T=new h.LOD;break;case"Line":T=new c.Line(P(e.geometry),U(e.material));break;case"LineLoop":T=new p.LineLoop(P(e.geometry),U(e.material));break;case"LineSegments":T=new l.LineSegments(P(e.geometry),U(e.material));break;case"PointCloud":case"Points":T=new d.Points(P(e.geometry),U(e.material));break;case"Sprite":T=new u.Sprite(U(e.material));break;case"Group":T=new o.Group;break;case"Bone":T=new f.Bone;break;default:T=new n.Object3D}if(T.uuid=e.uuid,void 0!==e.name&&(T.name=e.name),void 0!==e.matrix?(T.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(T.matrixAutoUpdate=e.matrixAutoUpdate),T.matrixAutoUpdate&&T.matrix.decompose(T.position,T.quaternion,T.scale)):(void 0!==e.position&&T.position.fromArray(e.position),void 0!==e.rotation&&T.rotation.fromArray(e.rotation),void 0!==e.quaternion&&T.quaternion.fromArray(e.quaternion),void 0!==e.scale&&T.scale.fromArray(e.scale)),void 0!==e.castShadow&&(T.castShadow=e.castShadow),void 0!==e.receiveShadow&&(T.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(T.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(T.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(T.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&T.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(T.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(T.visible=e.visible),void 0!==e.frustumCulled&&(T.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(T.renderOrder=e.renderOrder),void 0!==e.userData&&(T.userData=e.userData),void 0!==e.layers&&(T.layers.mask=e.layers),void 0!==e.children)for(var I=e.children,N=0;N<I.length;N++)T.add(this.parseObject(I[N],r,t,v,b));if(void 0!==e.animations)for(var q=e.animations,z=0;z<q.length;z++){var W=q[z];T.animations.push(b[W])}if("LOD"===e.type){void 0!==e.autoUpdate&&(T.autoUpdate=e.autoUpdate);for(var J=e.levels,V=0;V<J.length;V++){var _=J[V],Y=T.getObjectByProperty("uuid",_.object);void 0!==Y&&T.addLevel(Y,_.distance)}}return T},N.bindSkeletons=function(e,r){0!==Object.keys(r).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var t=r[e.skeleton];void 0===t?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(t,e.bindMatrix)}}))},N.setTexturePath=function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},t}(N.Loader),V={UVMapping:t.UVMapping,CubeReflectionMapping:t.CubeReflectionMapping,CubeRefractionMapping:t.CubeRefractionMapping,EquirectangularReflectionMapping:t.EquirectangularReflectionMapping,EquirectangularRefractionMapping:t.EquirectangularRefractionMapping,CubeUVReflectionMapping:t.CubeUVReflectionMapping},_={RepeatWrapping:t.RepeatWrapping,ClampToEdgeWrapping:t.ClampToEdgeWrapping,MirroredRepeatWrapping:t.MirroredRepeatWrapping},Y={NearestFilter:t.NearestFilter,NearestMipmapNearestFilter:t.NearestMipmapNearestFilter,NearestMipmapLinearFilter:t.NearestMipmapLinearFilter,LinearFilter:t.LinearFilter,LinearMipmapNearestFilter:t.LinearMipmapNearestFilter,LinearMipmapLinearFilter:t.LinearMipmapLinearFilter};e.ObjectLoader=J,Object.defineProperty(e,"__esModule",{value:!0})}));
