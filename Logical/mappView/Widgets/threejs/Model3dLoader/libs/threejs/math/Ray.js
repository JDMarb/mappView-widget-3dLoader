/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","./Vector3"],(function(t,i){"use strict";var n=new i.Vector3,r=new i.Vector3,o=new i.Vector3,e=new i.Vector3,s=new i.Vector3,c=new i.Vector3,a=new i.Vector3,u=function(){function t(t,n){void 0===t&&(t=new i.Vector3),void 0===n&&(n=new i.Vector3(0,0,-1)),this.origin=t,this.direction=n}var u=t.prototype;return u.set=function(t,i){return this.origin.copy(t),this.direction.copy(i),this},u.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},u.at=function(t,i){return i.copy(this.direction).multiplyScalar(t).add(this.origin)},u.lookAt=function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},u.recast=function(t){return this.origin.copy(this.at(t,n)),this},u.closestPointToPoint=function(t,i){i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},u.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},u.distanceSqToPoint=function(t){var i=n.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(n.copy(this.direction).multiplyScalar(i).add(this.origin),n.distanceToSquared(t))},u.distanceSqToSegment=function(t,i,n,s){r.copy(t).add(i).multiplyScalar(.5),o.copy(i).sub(t).normalize(),e.copy(this.origin).sub(r);var c,a,u,h,l=.5*t.distanceTo(i),d=-this.direction.dot(o),f=e.dot(this.direction),y=-e.dot(o),m=e.lengthSq(),p=Math.abs(1-d*d);if(p>0)if(a=d*f-y,h=l*p,(c=d*y-f)>=0)if(a>=-h)if(a<=h){var x=1/p;u=(c*=x)*(c+d*(a*=x)+2*f)+a*(d*c+a+2*y)+m}else a=l,u=-(c=Math.max(0,-(d*a+f)))*c+a*(a+2*y)+m;else a=-l,u=-(c=Math.max(0,-(d*a+f)))*c+a*(a+2*y)+m;else a<=-h?u=-(c=Math.max(0,-(-d*l+f)))*c+(a=c>0?-l:Math.min(Math.max(-l,-y),l))*(a+2*y)+m:a<=h?(c=0,u=(a=Math.min(Math.max(-l,-y),l))*(a+2*y)+m):u=-(c=Math.max(0,-(d*l+f)))*c+(a=c>0?l:Math.min(Math.max(-l,-y),l))*(a+2*y)+m;else a=d>0?-l:l,u=-(c=Math.max(0,-(d*a+f)))*c+a*(a+2*y)+m;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),s&&s.copy(o).multiplyScalar(a).add(r),u},u.intersectSphere=function(t,i){n.subVectors(t.center,this.origin);var r=n.dot(this.direction),o=n.dot(n)-r*r,e=t.radius*t.radius;if(o>e)return null;var s=Math.sqrt(e-o),c=r-s,a=r+s;return c<0&&a<0?null:c<0?this.at(a,i):this.at(c,i)},u.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},u.distanceToPlane=function(t){var i=t.normal.dot(this.direction);if(0===i)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/i;return n>=0?n:null},u.intersectPlane=function(t,i){var n=this.distanceToPlane(t);return null===n?null:this.at(n,i)},u.intersectsPlane=function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0},u.intersectBox=function(t,i){var n,r,o,e,s,c,a=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,l=this.origin;return a>=0?(n=(t.min.x-l.x)*a,r=(t.max.x-l.x)*a):(n=(t.max.x-l.x)*a,r=(t.min.x-l.x)*a),u>=0?(o=(t.min.y-l.y)*u,e=(t.max.y-l.y)*u):(o=(t.max.y-l.y)*u,e=(t.min.y-l.y)*u),n>e||o>r?null:((o>n||n!=n)&&(n=o),(e<r||r!=r)&&(r=e),h>=0?(s=(t.min.z-l.z)*h,c=(t.max.z-l.z)*h):(s=(t.max.z-l.z)*h,c=(t.min.z-l.z)*h),n>c||s>r?null:((s>n||n!=n)&&(n=s),(c<r||r!=r)&&(r=c),r<0?null:this.at(n>=0?n:r,i)))},u.intersectsBox=function(t){return null!==this.intersectBox(t,n)},u.intersectTriangle=function(t,i,n,r,o){s.subVectors(i,t),c.subVectors(n,t),a.crossVectors(s,c);var u,h=this.direction.dot(a);if(h>0){if(r)return null;u=1}else{if(!(h<0))return null;u=-1,h=-h}e.subVectors(this.origin,t);var l=u*this.direction.dot(c.crossVectors(e,c));if(l<0)return null;var d=u*this.direction.dot(s.cross(e));if(d<0)return null;if(l+d>h)return null;var f=-u*e.dot(a);return f<0?null:this.at(f/h,o)},u.applyMatrix4=function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},u.equals=function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},u.clone=function(){return(new this.constructor).copy(this)},t}();t.Ray=u,Object.defineProperty(t,"__esModule",{value:!0})}));
