/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","./scenes/Scene","./math/Vector3","./math/Vector2","./renderers/WebGLRenderer","./cameras/PerspectiveCamera","./core/Raycaster","./controls/OrbitControls","./objects/Group","./textures/CanvasTexture","./materials/MeshPhysicalMaterial","./materials/MeshBasicMaterial","./objects/Mesh","./loaders/FontLoader","./helpers/ArrowHelper","./constants","./lights/DirectionalLight","./lights/AmbientLight","./core/EventDispatcher","./geometries/BoxGeometry","./geometries/SphereGeometry","./geometries/ShapeGeometry"],(function(e,t,n,r,a,o,i,s,c,d,l,m,p,u,h,x,g,v,b,y,w,_){"use strict";var f=function(e,b,f,M,B,z){var S=this;S.isTetrahedron=B,S.Sizes=z,S.textX,S.textY,S.textZ;var E=Object.assign({width:100,height:100,className:"",backgroundColor:16777215,backgroundOpacity:0,cameraFov:50,cameraNear:1,cameraFar:1e3,cameraDistance:150,boxBackground:"#ddd",boxColor:"#222",boxCanvasSide:64,boxFontSize:14,boxFontFamily:"Arial",model3D:null,addRing:!0,addLights:!0,addOrbitControls:!0},f),C=Object.assign({px:"East",nx:"West",pz:"South",nz:"North",py:"Above",ny:"Below"},M);E.labels=["px","nx","py","ny","pz","nz"].map((function(e){return C[e]}));var P=!0,L=!0;Object.defineProperty(S,"enabled",{get:function(){return P},set:function(e){P=!!e,S._internalControls&&(S._internalControls=P),S.dispatchEvent({type:"enabled",value:P})}}),Object.defineProperty(S,"visible",{get:function(){return L},set:function(e){L=!!e,S._renderer.domElement.style.display=L?"initial":"none"}}),Object.defineProperty(S,"scene",{get:function(){return S._scene}}),Object.defineProperty(S,"domElement",{get:function(){return S._renderer.domElement}});var D,O=e.position,R=b&&b.target||new n.Vector3,A=new n.Vector3,G=new r.Vector2,j=new r.Vector2,k=null;function F(){var e=S._renderer.domElement;S._mouseDown=function(e){j.set(e.clientX,e.clientY)},S._mouseUp=function(e){if(P&&!(Math.abs(j.x-e.clientX)>5||Math.abs(j.y!==e.clientY)>5)){k||S._onResize(),G.x=(e.clientX-k.left)/k.width*2-1,G.y=-(e.clientY-k.top)/k.height*2+1,S._raycaster.setFromCamera(G,S._camera);var t=S._raycaster.intersectObjects(D.children,!1);if(t.length){var r=(new n.Vector3).copy(t[0].face.normal).normalize();S.dispatchEvent({type:"click",normal:r,direction:S._camera.position.clone().normalize()})}}},S._onResize=function(){k=e.getBoundingClientRect()},e.addEventListener("pointerdown",S._mouseDown),e.addEventListener("pointerup",S._mouseUp),e.addEventListener("resize",S._onResize)}function V(){var e=S._renderer.domElement;e.removeEventListener("pointerdown",S._mouseDown),e.removeEventListener("pointerup",S._mouseUp),e.removeEventListener("resize",S._onResize)}function X(){return A.subVectors(O,R).normalize().multiplyScalar(E.cameraDistance)}function Y(e,t){for(var r=D.children.length;r>=0;r-=1)D.remove(D.children[r]);if(e)D.add(e);else if(S.isTetrahedron){var a=function(){var e=new n.Vector3(0,0,0),t=new c.Group,r=new w.SphereGeometry(.01),a=new m.MeshBasicMaterial({color:4539717}),o=new p.Mesh(r,a);o.position.set(0,0,0),new m.MeshBasicMaterial({color:16777215}),(new u.FontLoader).load("https://threejs.org/examples/fonts/helvetiker_regular.typeface.json",(function(e){var n=new m.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.8,side:x.DoubleSide}),r="X",a=e.generateShapes(r,10),o=new _.ShapeGeometry(a);o.computeBoundingBox();var i=-.5*(o.boundingBox.max.x-o.boundingBox.min.x);o.translate(i,0,0),S.textX=new p.Mesh(o,n),S.textX.position.x=35,S.textX.position.y=0,S.textX.position.z=10,t.add(S.textX),r="Y",a=e.generateShapes(r,10),(o=new _.ShapeGeometry(a)).computeBoundingBox(),i=-.5*(o.boundingBox.max.x-o.boundingBox.min.x),o.translate(i,0,0),S.textY=new p.Mesh(o,n),S.textY.position.x=0,S.textY.position.y=35,S.textY.position.z=10,t.add(S.textY),r="Z",a=e.generateShapes(r,10),(o=new _.ShapeGeometry(a)).computeBoundingBox(),i=-.5*(o.boundingBox.max.x-o.boundingBox.min.x),o.translate(i,0,0),S.textZ=new p.Mesh(o,n),S.textZ.position.x=0,S.textZ.position.y=0,S.textZ.position.z=50,t.add(S.textZ),S.textReady=!0,Z()}));var i=new h.ArrowHelper(new n.Vector3(1,0,0),e,40,16711680,10,10),s=new h.ArrowHelper(new n.Vector3(0,1,0),e,40,65280,10,10),d=new h.ArrowHelper(new n.Vector3(0,0,1),e,40,255,10,10);return t.add(o),t.add(i),t.add(s),t.add(d),t.rotation.set(-Math.PI/2,0,S.Sizes.origin.rotation*Math.PI/180),t}();D.add(a)}else{var o=function(e){var t=E.boxCanvasSide,n=.5*t,r=E.boxFontSize+"px "+E.boxFontFamily,a=e<1?{transparent:!0,opacity:e}:{};function o(e,o,i){var s=document.createElement("canvas"),c=s.getContext("2d"),m=Math.round(S.devicePixelRatio);s.width=t*m,s.height=t*m,c.scale(m,m),c.beginPath(),c.fillStyle=e,c.rect(0,0,t,t),c.fill(),c.fillStyle=o,c.textAlign="center",c.textBaseline="middle",c.font=r,c.fillText(i,n,n);var p=new d.CanvasTexture(s),u=new l.MeshPhysicalMaterial(Object.assign({map:p},a));return u.name="mat-"+i,u.needsUpdate=!0,u}var i=E.labels.map((function(e){return o(E.boxBackground,E.boxColor,e)})),s=new p.Mesh(new y.BoxGeometry(5,5,5,1,1,1),i);return s.name="orientation-helper-cube",s.geometry.computeBoundingBox(),s.updateMatrixWorld(),s.matrixAutoUpdate=!1,s}(1);o.layers.enable(1),D.add(o)}S._renderer.render(S._scene,S._camera)}function Z(){S._camera.position.copy(X()),S._camera.lookAt(0,0,0),S.textReady&&(S.textX.lookAt(S._camera.position),S.textY.lookAt(S._camera.position),S.textZ.lookAt(S._camera.position)),S._renderer.render(S._scene,S._camera)}S.update=Z,S.takePicture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";return new Promise((function(t){S._renderer.render(S._scene,S._camera),t(S._renderer.domElement.toDataURL(e))}))},S.setGizmo=Y,S.activate=F,S.deactivate=V,S.dispose=V,function(){if(S._scene=new t.Scene,S._scene.name="orientation-helper-scene",S._renderer=new a.WebGLRenderer({antialias:!0,alpha:E.backgroundOpacity<1}),S._renderer.setClearColor(E.backgroundColor,E.backgroundOpacity),S._renderer.setPixelRatio(S.devicePixelRatio),S._renderer.setSize(E.width,E.height),S._renderer.domElement.className="orientation-helper-scene "+E.className,S._camera=new o.PerspectiveCamera(E.cameraFov,E.width/E.height,E.cameraNear,E.cameraFar),S._raycaster=new i.Raycaster,S._raycaster.layers.enable(1),S._camera.position.copy(X()),b?b.addEventListener("change",(function(){Z()})):console.warn("No controls provided. Will use 0,0,0 as target."),E.addOrbitControls){var e=new s.OrbitControls(S._camera,S._renderer.domElement);e.enableDamping=!0,e.dampingFactor=.2,e.minPolarAngle=0,e.maxPolarAngle=Math.PI,e.maxDistance=E.cameraDistance,e.minDistance=E.cameraDistance,e.enableKeys=!1,e.enablePan=!1,e.enableZoom=!1,e.screenSpacePanning=!0,e.addEventListener("change",(function(){S.dispatchEvent({type:"change",direction:S._camera.position.clone().normalize()})})),S._internalControls=e}(D=new c.Group).name="orientation-helper-gizmo",S._scene.add(D),Y(E.model3D,E.addRing),E.addLights&&S._scene.add(function(){var e=new c.Group;e.name="orientation-helper-lights";var t=new g.DirectionalLight(16770994,.15);return t.position.set(500,300,-500),e.add(t),(t=new g.DirectionalLight(16774570,.15)).position.set(-500,-300,500),e.add(t),e.add(new v.AmbientLight("#fff",.95)),e}())}(),F(),Z()};(f.prototype=Object.create(b.EventDispatcher.prototype)).constructor=f,e.OrientationHelper=f,Object.defineProperty(e,"__esModule",{value:!0})}));
