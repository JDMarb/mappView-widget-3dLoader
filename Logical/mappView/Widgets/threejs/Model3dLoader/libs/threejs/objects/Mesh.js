/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","../math/Vector3","../math/Vector2","../math/Sphere","../math/Ray","../math/Matrix4","../core/Object3D","../math/Triangle","../constants","../materials/MeshBasicMaterial","../core/BufferGeometry"],(function(e,t,r,a,o,n,i,s,c,u,f,l){"use strict";var h=new i.Matrix4,m=new n.Ray,d=new o.Sphere,p=new r.Vector3,g=new r.Vector3,v=new r.Vector3,b=new r.Vector3,y=new r.Vector3,M=new r.Vector3,x=new r.Vector3,V=new r.Vector3,T=new r.Vector3,w=new a.Vector2,B=new a.Vector2,A=new a.Vector2,I=new r.Vector3,S=new r.Vector3,D=function(e){function r(t,r){var a;return void 0===t&&(t=new l.BufferGeometry),void 0===r&&(r=new f.MeshBasicMaterial),(a=e.call(this)||this).isMesh=!0,a.type="Mesh",a.geometry=t,a.material=r,a.updateMorphTargets(),a}t.inheritsLoose(r,e);var a=r.prototype;return a.copy=function(t,r){return e.prototype.copy.call(this,t,r),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},a.updateMorphTargets=function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,o=r.length;a<o;a++){var n=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=a}}}},a.raycast=function(e,t){var r=this.geometry,a=this.material,o=this.matrixWorld;if(void 0!==a&&(null===r.boundingSphere&&r.computeBoundingSphere(),d.copy(r.boundingSphere),d.applyMatrix4(o),!1!==e.ray.intersectsSphere(d)&&(h.copy(o).invert(),m.copy(e.ray).applyMatrix4(h),null===r.boundingBox||!1!==m.intersectsBox(r.boundingBox)))){var n,i=r.index,s=r.attributes.position,c=r.morphAttributes.position,u=r.morphTargetsRelative,f=r.attributes.uv,l=r.attributes.uv2,p=r.groups,g=r.drawRange;if(null!==i)if(Array.isArray(a))for(var v=0,b=p.length;v<b;v++)for(var y=p[v],M=a[y.materialIndex],x=Math.max(y.start,g.start),V=Math.min(i.count,Math.min(y.start+y.count,g.start+g.count));x<V;x+=3){var T=i.getX(x),w=i.getX(x+1),B=i.getX(x+2);(n=j(this,M,e,m,s,c,u,f,l,T,w,B))&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=y.materialIndex,t.push(n))}else for(var A=Math.max(0,g.start),I=Math.min(i.count,g.start+g.count);A<I;A+=3){var S=i.getX(A),D=i.getX(A+1),X=i.getX(A+2);(n=j(this,a,e,m,s,c,u,f,l,S,D,X))&&(n.faceIndex=Math.floor(A/3),t.push(n))}else if(void 0!==s)if(Array.isArray(a))for(var O=0,R=p.length;O<R;O++)for(var _=p[O],k=a[_.materialIndex],G=Math.max(_.start,g.start),P=Math.min(s.count,Math.min(_.start+_.count,g.start+g.count));G<P;G+=3){(n=j(this,k,e,m,s,c,u,f,l,G,G+1,G+2))&&(n.faceIndex=Math.floor(G/3),n.face.materialIndex=_.materialIndex,t.push(n))}else for(var U=Math.max(0,g.start),W=Math.min(s.count,g.start+g.count);U<W;U+=3){(n=j(this,a,e,m,s,c,u,f,l,U,U+1,U+2))&&(n.faceIndex=Math.floor(U/3),t.push(n))}}},r}(s.Object3D);function j(e,t,o,n,i,s,f,l,h,m,d,D){p.fromBufferAttribute(i,m),g.fromBufferAttribute(i,d),v.fromBufferAttribute(i,D);var j=e.morphTargetInfluences;if(s&&j){x.set(0,0,0),V.set(0,0,0),T.set(0,0,0);for(var X=0,O=s.length;X<O;X++){var R=j[X],_=s[X];0!==R&&(b.fromBufferAttribute(_,m),y.fromBufferAttribute(_,d),M.fromBufferAttribute(_,D),f?(x.addScaledVector(b,R),V.addScaledVector(y,R),T.addScaledVector(M,R)):(x.addScaledVector(b.sub(p),R),V.addScaledVector(y.sub(g),R),T.addScaledVector(M.sub(v),R)))}p.add(x),g.add(V),v.add(T)}e.isSkinnedMesh&&(e.boneTransform(m,p),e.boneTransform(d,g),e.boneTransform(D,v));var k=function(e,t,r,a,o,n,i,s){if(null===(t.side===u.BackSide?a.intersectTriangle(i,n,o,!0,s):a.intersectTriangle(o,n,i,t.side!==u.DoubleSide,s)))return null;S.copy(s),S.applyMatrix4(e.matrixWorld);var c=r.ray.origin.distanceTo(S);return c<r.near||c>r.far?null:{distance:c,point:S.clone(),object:e}}(e,t,o,n,p,g,v,I);if(k){l&&(w.fromBufferAttribute(l,m),B.fromBufferAttribute(l,d),A.fromBufferAttribute(l,D),k.uv=c.Triangle.getUV(I,p,g,v,w,B,A,new a.Vector2)),h&&(w.fromBufferAttribute(h,m),B.fromBufferAttribute(h,d),A.fromBufferAttribute(h,D),k.uv2=c.Triangle.getUV(I,p,g,v,w,B,A,new a.Vector2));var G={a:m,b:d,c:D,normal:new r.Vector3,materialIndex:0};c.Triangle.getNormal(p,g,v,G.normal),k.face=G}return k}e.Mesh=D,Object.defineProperty(e,"__esModule",{value:!0})}));
