/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../_virtual/_rollupPluginBabelHelpers","./Mesh","../math/Matrix4","../math/Vector3","../math/Vector4"],(function(t,e,i,n,r,o){"use strict";var s=new r.Vector3,a=new o.Vector4,d=new o.Vector4,h=new r.Vector3,c=new n.Matrix4,l=function(t){function i(e,i){var r;return(r=t.call(this,e,i)||this).isSkinnedMesh=!0,r.type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new n.Matrix4,r.bindMatrixInverse=new n.Matrix4,r}e.inheritsLoose(i,t);var r=i.prototype;return r.copy=function(e,i){return t.prototype.copy.call(this,e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},r.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},r.pose=function(){this.skeleton.pose()},r.normalizeSkinWeights=function(){for(var t=new o.Vector4,e=this.geometry.attributes.skinWeight,i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);var r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},r.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},r.boneTransform=function(t,e){var i=this.skeleton,n=this.geometry;a.fromBufferAttribute(n.attributes.skinIndex,t),d.fromBufferAttribute(n.attributes.skinWeight,t),s.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var r=0;r<4;r++){var o=d.getComponent(r);if(0!==o){var l=a.getComponent(r);c.multiplyMatrices(i.bones[l].matrixWorld,i.boneInverses[l]),e.addScaledVector(h.copy(s).applyMatrix4(c),o)}}return e.applyMatrix4(this.bindMatrixInverse)},i}(i.Mesh);t.SkinnedMesh=l,Object.defineProperty(t,"__esModule",{value:!0})}));
