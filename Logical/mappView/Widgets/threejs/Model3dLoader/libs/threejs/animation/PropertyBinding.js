/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports"],(function(e){"use strict";var t="\\[\\]\\.:\\/",r=new RegExp("[\\[\\]\\.:\\/]","g"),o="[^\\[\\]\\.:\\/]",a="[^"+t.replace("\\.","")+"]",n=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",o)+/(WCOD+)?/.source.replace("WCOD",a)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",o)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",o)+"$"),i=["material","materials","bones"],s=function(){function e(e,t,r){var o=r||d.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,o)}var t=e.prototype;return t.getValue=function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,o=this._bindings[r];void 0!==o&&o.getValue(e,t)},t.setValue=function(e,t){for(var r=this._bindings,o=this._targetGroup.nCachedObjects_,a=r.length;o!==a;++o)r[o].setValue(e,t)},t.bind=function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},t.unbind=function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()},e}(),d=function(){function e(t,r,o){this.path=r,this.parsedPath=o||e.parseTrackName(r),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}e.create=function(t,r,o){return t&&t.isAnimationObjectGroup?new e.Composite(t,r,o):new e(t,r,o)},e.sanitizeNodeName=function(e){return e.replace(/\s/g,"_").replace(r,"")},e.parseTrackName=function(e){var t=n.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){var a=r.nodeName.substring(o+1);-1!==i.indexOf(a)&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=a)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},e.findNode=function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var o=function e(r){for(var o=0;o<r.length;o++){var a=r[o];if(a.name===t||a.uuid===t)return a;var n=e(a.children);if(n)return n}return null}(e.children);if(o)return o}return null};var t=e.prototype;return t._getValue_unavailable=function(){},t._setValue_unavailable=function(){},t._getValue_direct=function(e,t){e[t]=this.targetObject[this.propertyName]},t._getValue_array=function(e,t){for(var r=this.resolvedProperty,o=0,a=r.length;o!==a;++o)e[t++]=r[o]},t._getValue_arrayElement=function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},t._getValue_toArray=function(e,t){this.resolvedProperty.toArray(e,t)},t._setValue_direct=function(e,t){this.targetObject[this.propertyName]=e[t]},t._setValue_direct_setNeedsUpdate=function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},t._setValue_direct_setMatrixWorldNeedsUpdate=function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0},t._setValue_array=function(e,t){for(var r=this.resolvedProperty,o=0,a=r.length;o!==a;++o)r[o]=e[t++]},t._setValue_array_setNeedsUpdate=function(e,t){for(var r=this.resolvedProperty,o=0,a=r.length;o!==a;++o)r[o]=e[t++];this.targetObject.needsUpdate=!0},t._setValue_array_setMatrixWorldNeedsUpdate=function(e,t){for(var r=this.resolvedProperty,o=0,a=r.length;o!==a;++o)r[o]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0},t._setValue_arrayElement=function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},t._setValue_arrayElement_setNeedsUpdate=function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},t._setValue_arrayElement_setMatrixWorldNeedsUpdate=function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0},t._setValue_fromArray=function(e,t){this.resolvedProperty.fromArray(e,t)},t._setValue_fromArray_setNeedsUpdate=function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},t._setValue_fromArray_setMatrixWorldNeedsUpdate=function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0},t._getValue_unbound=function(e,t){this.bind(),this.getValue(e,t)},t._setValue_unbound=function(e,t){this.bind(),this.setValue(e,t)},t.bind=function(){var t=this.node,r=this.parsedPath,o=r.objectName,a=r.propertyName,n=r.propertyIndex;if(t||(t=e.findNode(this.rootNode,r.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(o){var i=r.objectIndex;switch(o){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===i){i=s;break}break;default:if(void 0===t[o])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[o]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}var d=t[a];if(void 0!==d){var p=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?p=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(p=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===a){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[n]&&(n=t.morphTargetDictionary[n])}l=this.BindingType.ArrayElement,this.resolvedProperty=d,this.propertyIndex=n}else void 0!==d.fromArray&&void 0!==d.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=d):Array.isArray(d)?(l=this.BindingType.EntireArray,this.resolvedProperty=d):this.propertyName=a;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][p]}else{var u=r.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+a+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},t.unbind=function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound},e}();d.Composite=s,d.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},d.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},d.prototype.GetterByBindingType=[d.prototype._getValue_direct,d.prototype._getValue_array,d.prototype._getValue_arrayElement,d.prototype._getValue_toArray],d.prototype.SetterByBindingTypeAndVersioning=[[d.prototype._setValue_direct,d.prototype._setValue_direct_setNeedsUpdate,d.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[d.prototype._setValue_array,d.prototype._setValue_array_setNeedsUpdate,d.prototype._setValue_array_setMatrixWorldNeedsUpdate],[d.prototype._setValue_arrayElement,d.prototype._setValue_arrayElement_setNeedsUpdate,d.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[d.prototype._setValue_fromArray,d.prototype._setValue_fromArray_setNeedsUpdate,d.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],e.PropertyBinding=d,Object.defineProperty(e,"__esModule",{value:!0})}));
