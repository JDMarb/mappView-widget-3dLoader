/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../math/Quaternion"],(function(i,t){"use strict";var e=function(){function i(i,t,e){var s,r,u;switch(this.binding=i,this.valueSize=e,t){case"quaternion":s=this._slerp,r=this._slerpAdditive,u=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*e),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,u=this._setAdditiveIdentityOther,this.buffer=new Array(5*e);break;default:s=this._lerp,r=this._lerpAdditive,u=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*e)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=u,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}var e=i.prototype;return e.accumulate=function(i,t){var e=this.buffer,s=this.valueSize,r=i*s+s,u=this.cumulativeWeight;if(0===u){for(var n=0;n!==s;++n)e[r+n]=e[n];u=t}else{var a=t/(u+=t);this._mixBufferRegion(e,r,0,a,s)}this.cumulativeWeight=u},e.accumulateAdditive=function(i){var t=this.buffer,e=this.valueSize,s=e*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,i,e),this.cumulativeWeightAdditive+=i},e.apply=function(i){var t=this.valueSize,e=this.buffer,s=i*t+t,r=this.cumulativeWeight,u=this.cumulativeWeightAdditive,n=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var a=t*this._origIndex;this._mixBufferRegion(e,s,a,1-r,t)}u>0&&this._mixBufferRegionAdditive(e,s,this._addIndex*t,1,t);for(var h=t,d=t+t;h!==d;++h)if(e[h]!==e[h+t]){n.setValue(e,s);break}},e.saveOriginalState=function(){var i=this.binding,t=this.buffer,e=this.valueSize,s=e*this._origIndex;i.getValue(t,s);for(var r=e,u=s;r!==u;++r)t[r]=t[s+r%e];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},e.restoreOriginalState=function(){var i=3*this.valueSize;this.binding.setValue(this.buffer,i)},e._setAdditiveIdentityNumeric=function(){for(var i=this._addIndex*this.valueSize,t=i+this.valueSize,e=i;e<t;e++)this.buffer[e]=0},e._setAdditiveIdentityQuaternion=function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},e._setAdditiveIdentityOther=function(){for(var i=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,e=0;e<this.valueSize;e++)this.buffer[t+e]=this.buffer[i+e]},e._select=function(i,t,e,s,r){if(s>=.5)for(var u=0;u!==r;++u)i[t+u]=i[e+u]},e._slerp=function(i,e,s,r){t.Quaternion.slerpFlat(i,e,i,e,i,s,r)},e._slerpAdditive=function(i,e,s,r,u){var n=this._workIndex*u;t.Quaternion.multiplyQuaternionsFlat(i,n,i,e,i,s),t.Quaternion.slerpFlat(i,e,i,e,i,n,r)},e._lerp=function(i,t,e,s,r){for(var u=1-s,n=0;n!==r;++n){var a=t+n;i[a]=i[a]*u+i[e+n]*s}},e._lerpAdditive=function(i,t,e,s,r){for(var u=0;u!==r;++u){var n=t+u;i[n]=i[n]+i[e+u]*s}},i}();i.PropertyMixer=e,Object.defineProperty(i,"__esModule",{value:!0})}));
