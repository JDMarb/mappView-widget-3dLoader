/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../constants"],(function(t,i){"use strict";var e=function(){function t(t,e,n,s){void 0===n&&(n=null),void 0===s&&(s=e.blendMode),this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=s;for(var r=e.tracks,a=r.length,o=new Array(a),h={endingStart:i.ZeroCurvatureEnding,endingEnd:i.ZeroCurvatureEnding},l=0;l!==a;++l){var u=r[l].createInterpolant(null);o[l]=u,u.settings=h}this._interpolantSettings=h,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=i.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}var e=t.prototype;return e.play=function(){return this._mixer._activateAction(this),this},e.stop=function(){return this._mixer._deactivateAction(this),this.reset()},e.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},e.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},e.isScheduled=function(){return this._mixer._isActiveAction(this)},e.startAt=function(t){return this._startTime=t,this},e.setLoop=function(t,i){return this.loop=t,this.repetitions=i,this},e.setEffectiveWeight=function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},e.getEffectiveWeight=function(){return this._effectiveWeight},e.fadeIn=function(t){return this._scheduleFading(t,0,1)},e.fadeOut=function(t){return this._scheduleFading(t,1,0)},e.crossFadeFrom=function(t,i,e){if(t.fadeOut(i),this.fadeIn(i),e){var n=this._clip.duration,s=t._clip.duration,r=s/n,a=n/s;t.warp(1,r,i),this.warp(a,1,i)}return this},e.crossFadeTo=function(t,i,e){return t.crossFadeFrom(this,i,e)},e.stopFading=function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},e.setEffectiveTimeScale=function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},e.getEffectiveTimeScale=function(){return this._effectiveTimeScale},e.setDuration=function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},e.syncWith=function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},e.halt=function(t){return this.warp(this._effectiveTimeScale,0,t)},e.warp=function(t,i,e){var n=this._mixer,s=n.time,r=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var o=a.parameterPositions,h=a.sampleValues;return o[0]=s,o[1]=s+e,h[0]=t/r,h[1]=i/r,this},e.stopWarping=function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},e.getMixer=function(){return this._mixer},e.getClip=function(){return this._clip},e.getRoot=function(){return this._localRoot||this._mixer._root},e._update=function(t,e,n,s){if(this.enabled){var r=this._startTime;if(null!==r){var a=(t-r)*n;if(a<0||0===n)return;this._startTime=null,e=n*a}e*=this._updateTimeScale(t);var o=this._updateTime(e),h=this._updateWeight(t);if(h>0){var l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case i.AdditiveAnimationBlendMode:for(var c=0,p=l.length;c!==p;++c)l[c].evaluate(o),u[c].accumulateAdditive(h);break;case i.NormalAnimationBlendMode:default:for(var d=0,_=l.length;d!==_;++d)l[d].evaluate(o),u[d].accumulate(s,h)}}}else this._updateWeight(t)},e._updateWeight=function(t){var i=0;if(this.enabled){i=this.weight;var e=this._weightInterpolant;if(null!==e){var n=e.evaluate(t)[0];i*=n,t>e.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=i,i},e._updateTimeScale=function(t){var i=0;if(!this.paused){i=this.timeScale;var e=this._timeScaleInterpolant;if(null!==e)i*=e.evaluate(t)[0],t>e.parameterPositions[1]&&(this.stopWarping(),0===i?this.paused=!0:this.timeScale=i)}return this._effectiveTimeScale=i,i},e._updateTime=function(t){var e=this._clip.duration,n=this.loop,s=this.time+t,r=this._loopCount,a=n===i.LoopPingPong;if(0===t)return-1===r?s:a&&1==(1&r)?e-s:s;if(n===i.LoopOnce){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(s>=e)s=e;else{if(!(s<0)){this.time=s;break t}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),s>=e||s<0){var o=Math.floor(s/e);s-=e*o,r+=Math.abs(o);var h=this.repetitions-r;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=t>0?e:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===h){var l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(a&&1==(1&r))return e-s}return s},e._setEndings=function(t,e,n){var s=this._interpolantSettings;n?(s.endingStart=i.ZeroSlopeEnding,s.endingEnd=i.ZeroSlopeEnding):(s.endingStart=t?this.zeroSlopeAtStart?i.ZeroSlopeEnding:i.ZeroCurvatureEnding:i.WrapAroundEnding,s.endingEnd=e?this.zeroSlopeAtEnd?i.ZeroSlopeEnding:i.ZeroCurvatureEnding:i.WrapAroundEnding)},e._scheduleFading=function(t,i,e){var n=this._mixer,s=n.time,r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);var a=r.parameterPositions,o=r.sampleValues;return a[0]=s,o[0]=i,a[1]=s+t,o[1]=e,this},t}();t.AnimationAction=e,Object.defineProperty(t,"__esModule",{value:!0})}));
