/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../math/Quaternion","../constants"],(function(r,e,t){"use strict";var a={arraySlice:function(r,e,t){return a.isTypedArray(r)?new r.constructor(r.subarray(e,void 0!==t?t:r.length)):r.slice(e,t)},convertArray:function(r,e,t){return!r||!t&&r.constructor===e?r:"number"==typeof e.BYTES_PER_ELEMENT?new e(r):Array.prototype.slice.call(r)},isTypedArray:function(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)},getKeyframeOrder:function(r){for(var e=r.length,t=new Array(e),a=0;a!==e;++a)t[a]=a;return t.sort((function(e,t){return r[e]-r[t]})),t},sortedArray:function(r,e,t){for(var a=r.length,n=new r.constructor(a),i=0,o=0;o!==a;++i)for(var s=t[i]*e,u=0;u!==e;++u)n[o++]=r[s+u];return n},flattenJSON:function(r,e,t,a){for(var n=1,i=r[0];void 0!==i&&void 0===i[a];)i=r[n++];if(void 0!==i){var o=i[a];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=i[a])&&(e.push(i.time),t.push.apply(t,o)),i=r[n++]}while(void 0!==i);else if(void 0!==o.toArray)do{void 0!==(o=i[a])&&(e.push(i.time),o.toArray(t,t.length)),i=r[n++]}while(void 0!==i);else do{void 0!==(o=i[a])&&(e.push(i.time),t.push(o)),i=r[n++]}while(void 0!==i)}},subclip:function(r,e,t,n,i){void 0===i&&(i=30);var o=r.clone();o.name=e;for(var s=[],u=0;u<o.tracks.length;++u){for(var l=o.tracks[u],c=l.getValueSize(),v=[],f=[],d=0;d<l.times.length;++d){var y=l.times[d]*i;if(!(y<t||y>=n)){v.push(l.times[d]);for(var p=0;p<c;++p)f.push(l.values[d*c+p])}}0!==v.length&&(l.times=a.convertArray(v,l.times.constructor),l.values=a.convertArray(f,l.values.constructor),s.push(l))}o.tracks=s;for(var m=1/0,h=0;h<o.tracks.length;++h)m>o.tracks[h].times[0]&&(m=o.tracks[h].times[0]);for(var A=0;A<o.tracks.length;++A)o.tracks[A].shift(-1*m);return o.resetDuration(),o},makeClipAdditive:function(r,n,i,o){void 0===n&&(n=0),void 0===i&&(i=r),void 0===o&&(o=30),o<=0&&(o=30);for(var s=i.tracks.length,u=n/o,l=function(t){var n=i.tracks[t],o=n.ValueTypeName;if("bool"===o||"string"===o)return"continue";var s=r.tracks.find((function(r){return r.name===n.name&&r.ValueTypeName===o}));if(void 0===s)return"continue";var l=0,c=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);var v=0,f=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=f/3);var d=n.times.length-1,y=void 0;if(u<=n.times[0]){var p=l,m=c-l;y=a.arraySlice(n.values,p,m)}else if(u>=n.times[d]){var h=d*c+l,A=h+c-l;y=a.arraySlice(n.values,h,A)}else{var g=n.createInterpolant(),k=l,S=c-l;g.evaluate(u),y=a.arraySlice(g.resultBuffer,k,S)}"quaternion"===o&&(new e.Quaternion).fromArray(y).normalize().conjugate().toArray(y);for(var w=s.times.length,b=0;b<w;++b){var T=b*f+v;if("quaternion"===o)e.Quaternion.multiplyQuaternionsFlat(s.values,T,y,0,s.values,T);else for(var V=f-2*v,M=0;M<V;++M)s.values[T+M]-=y[M]}},c=0;c<s;++c)l(c);return r.blendMode=t.AdditiveAnimationBlendMode,r}};r.AnimationUtils=a,Object.defineProperty(r,"__esModule",{value:!0})}));
