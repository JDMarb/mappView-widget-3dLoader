/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../../constants","../../math/Vector4"],(function(e,n,t){"use strict";e.WebGLState=function(e,l,a){var r,u,c=a.isWebGL2,i=new function(){var n=!1,l=new t.Vector4,a=null,r=new t.Vector4(0,0,0,0);return{setMask:function(t){a===t||n||(e.colorMask(t,t,t,t),a=t)},setLocked:function(e){n=e},setClear:function(n,t,a,u,c){!0===c&&(n*=u,t*=u,a*=u),l.set(n,t,a,u),!1===r.equals(l)&&(e.clearColor(n,t,a,u),r.copy(l))},reset:function(){n=!1,a=null,r.set(-1,0,0,0)}}},s=new function(){var t=!1,l=null,a=null,r=null;return{setTest:function(e){e?_(2929):V(2929)},setMask:function(n){l===n||t||(e.depthMask(n),l=n)},setFunc:function(t){if(a!==t){if(t)switch(t){case n.NeverDepth:e.depthFunc(512);break;case n.AlwaysDepth:e.depthFunc(519);break;case n.LessDepth:e.depthFunc(513);break;case n.LessEqualDepth:e.depthFunc(515);break;case n.EqualDepth:e.depthFunc(514);break;case n.GreaterEqualDepth:e.depthFunc(518);break;case n.GreaterDepth:e.depthFunc(516);break;case n.NotEqualDepth:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);a=t}},setLocked:function(e){t=e},setClear:function(n){r!==n&&(e.clearDepth(n),r=n)},reset:function(){t=!1,l=null,a=null,r=null}}},o=new function(){var n=!1,t=null,l=null,a=null,r=null,u=null,c=null,i=null,s=null;return{setTest:function(e){n||(e?_(2960):V(2960))},setMask:function(l){t===l||n||(e.stencilMask(l),t=l)},setFunc:function(n,t,u){l===n&&a===t&&r===u||(e.stencilFunc(n,t,u),l=n,a=t,r=u)},setOp:function(n,t,l){u===n&&c===t&&i===l||(e.stencilOp(n,t,l),u=n,c=t,i=l)},setLocked:function(e){n=e},setClear:function(n){s!==n&&(e.clearStencil(n),s=n)},reset:function(){n=!1,t=null,l=null,a=null,r=null,u=null,c=null,i=null,s=null}}},d={},f={},p=new WeakMap,b=[],h=null,F=!1,g=null,v=null,S=null,E=null,x=null,m=null,y=null,k=!1,D=null,T=null,M=null,w=null,L=null,W=e.getParameter(35661),q=!1,B=0,G=e.getParameter(7938);-1!==G.indexOf("WebGL")?(B=parseFloat(/^WebGL (\d)/.exec(G)[1]),q=B>=1):-1!==G.indexOf("OpenGL ES")&&(B=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),q=B>=2);var A=null,O={},C=e.getParameter(3088),I=e.getParameter(2978),R=(new t.Vector4).fromArray(C),P=(new t.Vector4).fromArray(I);function H(n,t,l){var a=new Uint8Array(4),r=e.createTexture();e.bindTexture(n,r),e.texParameteri(n,10241,9728),e.texParameteri(n,10240,9728);for(var u=0;u<l;u++)e.texImage2D(t+u,0,6408,1,1,0,6408,5121,a);return r}var N={};function _(n){!0!==d[n]&&(e.enable(n),d[n]=!0)}function V(n){!1!==d[n]&&(e.disable(n),d[n]=!1)}N[3553]=H(3553,3553,1),N[34067]=H(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),o.setClear(0),_(2929),s.setFunc(n.LessEqualDepth),j(!1),J(n.CullFaceBack),_(2884),U(n.NoBlending);var X=((r={})[n.AddEquation]=32774,r[n.SubtractEquation]=32778,r[n.ReverseSubtractEquation]=32779,r);if(c)X[n.MinEquation]=32775,X[n.MaxEquation]=32776;else{var Z=l.get("EXT_blend_minmax");null!==Z&&(X[n.MinEquation]=Z.MIN_EXT,X[n.MaxEquation]=Z.MAX_EXT)}var z=((u={})[n.ZeroFactor]=0,u[n.OneFactor]=1,u[n.SrcColorFactor]=768,u[n.SrcAlphaFactor]=770,u[n.SrcAlphaSaturateFactor]=776,u[n.DstColorFactor]=774,u[n.DstAlphaFactor]=772,u[n.OneMinusSrcColorFactor]=769,u[n.OneMinusSrcAlphaFactor]=771,u[n.OneMinusDstColorFactor]=775,u[n.OneMinusDstAlphaFactor]=773,u);function U(t,l,a,r,u,c,i,s){if(t!==n.NoBlending){if(!1===F&&(_(3042),F=!0),t===n.CustomBlending)u=u||l,c=c||a,i=i||r,l===v&&u===x||(e.blendEquationSeparate(X[l],X[u]),v=l,x=u),a===S&&r===E&&c===m&&i===y||(e.blendFuncSeparate(z[a],z[r],z[c],z[i]),S=a,E=r,m=c,y=i),g=t,k=null;else if(t!==g||s!==k){if(v===n.AddEquation&&x===n.AddEquation||(e.blendEquation(32774),v=n.AddEquation,x=n.AddEquation),s)switch(t){case n.NormalBlending:e.blendFuncSeparate(1,771,1,771);break;case n.AdditiveBlending:e.blendFunc(1,1);break;case n.SubtractiveBlending:e.blendFuncSeparate(0,769,0,1);break;case n.MultiplyBlending:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case n.NormalBlending:e.blendFuncSeparate(770,771,1,771);break;case n.AdditiveBlending:e.blendFunc(770,1);break;case n.SubtractiveBlending:e.blendFuncSeparate(0,769,0,1);break;case n.MultiplyBlending:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}S=null,E=null,m=null,y=null,g=t,k=s}}else!0===F&&(V(3042),F=!1)}function j(n){D!==n&&(n?e.frontFace(2304):e.frontFace(2305),D=n)}function J(t){t!==n.CullFaceNone?(_(2884),t!==T&&(t===n.CullFaceBack?e.cullFace(1029):t===n.CullFaceFront?e.cullFace(1028):e.cullFace(1032))):V(2884),T=t}function K(n,t,l){n?(_(32823),w===t&&L===l||(e.polygonOffset(t,l),w=t,L=l)):V(32823)}function Q(n){void 0===n&&(n=33984+W-1),A!==n&&(e.activeTexture(n),A=n)}return{buffers:{color:i,depth:s,stencil:o},enable:_,disable:V,bindFramebuffer:function(n,t){return f[n]!==t&&(e.bindFramebuffer(n,t),f[n]=t,c&&(36009===n&&(f[36160]=t),36160===n&&(f[36009]=t)),!0)},drawBuffers:function(n,t){var r=b,u=!1;if(n)if(void 0===(r=p.get(t))&&(r=[],p.set(t,r)),n.isWebGLMultipleRenderTargets){var c=n.texture;if(r.length!==c.length||36064!==r[0]){for(var i=0,s=c.length;i<s;i++)r[i]=36064+i;r.length=c.length,u=!0}}else 36064!==r[0]&&(r[0]=36064,u=!0);else 1029!==r[0]&&(r[0]=1029,u=!0);u&&(a.isWebGL2?e.drawBuffers(r):l.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(n){return h!==n&&(e.useProgram(n),h=n,!0)},setBlending:U,setMaterial:function(e,t){e.side===n.DoubleSide?V(2884):_(2884);var l=e.side===n.BackSide;t&&(l=!l),j(l),e.blending===n.NormalBlending&&!1===e.transparent?U(n.NoBlending):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),i.setMask(e.colorWrite);var a=e.stencilWrite;o.setTest(a),a&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),K(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?_(32926):V(32926)},setFlipSided:j,setCullFace:J,setLineWidth:function(n){n!==M&&(q&&e.lineWidth(n),M=n)},setPolygonOffset:K,setScissorTest:function(e){e?_(3089):V(3089)},activeTexture:Q,bindTexture:function(n,t){null===A&&Q();var l=O[A];void 0===l&&(l={type:void 0,texture:void 0},O[A]=l),l.type===n&&l.texture===t||(e.bindTexture(n,t||N[n]),l.type=n,l.texture=t)},unbindTexture:function(){var n=O[A];void 0!==n&&void 0!==n.type&&(e.bindTexture(n.type,null),n.type=void 0,n.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(n){!1===R.equals(n)&&(e.scissor(n.x,n.y,n.z,n.w),R.copy(n))},viewport:function(n){!1===P.equals(n)&&(e.viewport(n.x,n.y,n.z,n.w),P.copy(n))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===c&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},A=null,O={},f={},p=new WeakMap,b=[],h=null,F=!1,g=null,v=null,S=null,E=null,x=null,m=null,y=null,k=!1,D=null,T=null,M=null,w=null,L=null,R.set(0,0,e.canvas.width,e.canvas.height),P.set(0,0,e.canvas.width,e.canvas.height),i.reset(),s.reset(),o.reset()}}},Object.defineProperty(e,"__esModule",{value:!0})}));
