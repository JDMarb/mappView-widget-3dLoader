/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../../math/Color","../../math/Matrix4","../../math/Vector2","../../math/Vector3","../shaders/UniformsLib"],(function(t,i,o,a,e,r){"use strict";function n(){var t={};return{get:function(o){if(void 0!==t[o.id])return t[o.id];var a;switch(o.type){case"DirectionalLight":a={direction:new e.Vector3,color:new i.Color};break;case"SpotLight":a={position:new e.Vector3,direction:new e.Vector3,color:new i.Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new e.Vector3,color:new i.Color,distance:0,decay:0};break;case"HemisphereLight":a={direction:new e.Vector3,skyColor:new i.Color,groundColor:new i.Color};break;case"RectAreaLight":a={color:new i.Color,position:new e.Vector3,halfWidth:new e.Vector3,halfHeight:new e.Vector3}}return t[o.id]=a,a}}}var s=0;function h(t,i){return(i.castShadow?1:0)-(t.castShadow?1:0)}t.WebGLLights=function(t,i){for(var d,l=new n,c=(d={},{get:function(t){if(void 0!==d[t.id])return d[t.id];var i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new a.Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new a.Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return d[t.id]=i,i}}),p={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},w=0;w<9;w++)p.probe.push(new e.Vector3);var m=new e.Vector3,g=new o.Matrix4,S=new o.Matrix4;return{setup:function(o,a){for(var e=0,n=0,d=0,w=0;w<9;w++)p.probe[w].set(0,0,0);var m=0,g=0,S=0,u=0,L=0,f=0,x=0,M=0;o.sort(h);for(var b=!0!==a?Math.PI:1,y=0,v=o.length;y<v;y++){var C=o[y],A=C.color,P=C.intensity,W=C.distance,_=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)e+=A.r*P*b,n+=A.g*P*b,d+=A.b*P*b;else if(C.isLightProbe)for(var V=0;V<9;V++)p.probe[V].addScaledVector(C.sh.coefficients[V],P);else if(C.isDirectionalLight){var F=l.get(C);if(F.color.copy(C.color).multiplyScalar(C.intensity*b),C.castShadow){var B=C.shadow,T=c.get(C);T.shadowBias=B.bias,T.shadowNormalBias=B.normalBias,T.shadowRadius=B.radius,T.shadowMapSize=B.mapSize,p.directionalShadow[m]=T,p.directionalShadowMap[m]=_,p.directionalShadowMatrix[m]=C.shadow.matrix,f++}p.directional[m]=F,m++}else if(C.isSpotLight){var R=l.get(C);if(R.position.setFromMatrixPosition(C.matrixWorld),R.color.copy(A).multiplyScalar(P*b),R.distance=W,R.coneCos=Math.cos(C.angle),R.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),R.decay=C.decay,C.castShadow){var D=C.shadow,H=c.get(C);H.shadowBias=D.bias,H.shadowNormalBias=D.normalBias,H.shadowRadius=D.radius,H.shadowMapSize=D.mapSize,p.spotShadow[S]=H,p.spotShadowMap[S]=_,p.spotShadowMatrix[S]=C.shadow.matrix,M++}p.spot[S]=R,S++}else if(C.isRectAreaLight){var z=l.get(C);z.color.copy(A).multiplyScalar(P),z.halfWidth.set(.5*C.width,0,0),z.halfHeight.set(0,.5*C.height,0),p.rectArea[u]=z,u++}else if(C.isPointLight){var k=l.get(C);if(k.color.copy(C.color).multiplyScalar(C.intensity*b),k.distance=C.distance,k.decay=C.decay,C.castShadow){var N=C.shadow,U=c.get(C);U.shadowBias=N.bias,U.shadowNormalBias=N.normalBias,U.shadowRadius=N.radius,U.shadowMapSize=N.mapSize,U.shadowCameraNear=N.camera.near,U.shadowCameraFar=N.camera.far,p.pointShadow[g]=U,p.pointShadowMap[g]=_,p.pointShadowMatrix[g]=C.shadow.matrix,x++}p.point[g]=k,g++}else if(C.isHemisphereLight){var O=l.get(C);O.skyColor.copy(C.color).multiplyScalar(P*b),O.groundColor.copy(C.groundColor).multiplyScalar(P*b),p.hemi[L]=O,L++}}u>0&&(i.isWebGL2||!0===t.has("OES_texture_float_linear")?(p.rectAreaLTC1=r.UniformsLib.LTC_FLOAT_1,p.rectAreaLTC2=r.UniformsLib.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(p.rectAreaLTC1=r.UniformsLib.LTC_HALF_1,p.rectAreaLTC2=r.UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),p.ambient[0]=e,p.ambient[1]=n,p.ambient[2]=d;var E=p.hash;E.directionalLength===m&&E.pointLength===g&&E.spotLength===S&&E.rectAreaLength===u&&E.hemiLength===L&&E.numDirectionalShadows===f&&E.numPointShadows===x&&E.numSpotShadows===M||(p.directional.length=m,p.spot.length=S,p.rectArea.length=u,p.point.length=g,p.hemi.length=L,p.directionalShadow.length=f,p.directionalShadowMap.length=f,p.pointShadow.length=x,p.pointShadowMap.length=x,p.spotShadow.length=M,p.spotShadowMap.length=M,p.directionalShadowMatrix.length=f,p.pointShadowMatrix.length=x,p.spotShadowMatrix.length=M,E.directionalLength=m,E.pointLength=g,E.spotLength=S,E.rectAreaLength=u,E.hemiLength=L,E.numDirectionalShadows=f,E.numPointShadows=x,E.numSpotShadows=M,p.version=s++)},setupView:function(t,i){for(var o=0,a=0,e=0,r=0,n=0,s=i.matrixWorldInverse,h=0,d=t.length;h<d;h++){var l=t[h];if(l.isDirectionalLight){var c=p.directional[o];c.direction.setFromMatrixPosition(l.matrixWorld),m.setFromMatrixPosition(l.target.matrixWorld),c.direction.sub(m),c.direction.transformDirection(s),o++}else if(l.isSpotLight){var w=p.spot[e];w.position.setFromMatrixPosition(l.matrixWorld),w.position.applyMatrix4(s),w.direction.setFromMatrixPosition(l.matrixWorld),m.setFromMatrixPosition(l.target.matrixWorld),w.direction.sub(m),w.direction.transformDirection(s),e++}else if(l.isRectAreaLight){var u=p.rectArea[r];u.position.setFromMatrixPosition(l.matrixWorld),u.position.applyMatrix4(s),S.identity(),g.copy(l.matrixWorld),g.premultiply(s),S.extractRotation(g),u.halfWidth.set(.5*l.width,0,0),u.halfHeight.set(0,.5*l.height,0),u.halfWidth.applyMatrix4(S),u.halfHeight.applyMatrix4(S),r++}else if(l.isPointLight){var L=p.point[a];L.position.setFromMatrixPosition(l.matrixWorld),L.position.applyMatrix4(s),a++}else if(l.isHemisphereLight){var f=p.hemi[n];f.direction.setFromMatrixPosition(l.matrixWorld),f.direction.transformDirection(s),n++}}},state:p}},Object.defineProperty(t,"__esModule",{value:!0})}));
