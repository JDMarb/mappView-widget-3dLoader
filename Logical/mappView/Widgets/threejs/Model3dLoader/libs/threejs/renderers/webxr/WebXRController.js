/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../../_virtual/_rollupPluginBabelHelpers","../../math/Vector3","../../objects/Group"],(function(t,i,e,a){"use strict";var n={type:"move"},r=function(){function t(){this._targetRay=null,this._grip=null,this._hand=null}var r=t.prototype;return r.getHandSpace=function(){return null===this._hand&&(this._hand=new a.Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},r.getTargetRaySpace=function(){return null===this._targetRay&&(this._targetRay=new a.Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new e.Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new e.Vector3),this._targetRay},r.getGripSpace=function(){return null===this._grip&&(this._grip=new a.Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new e.Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new e.Vector3),this._grip},r.dispatchEvent=function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},r.disconnect=function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},r.update=function(t,e,r){var l=null,s=null,o=null,h=this._targetRay,u=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==h&&null!==(l=e.getPose(t.targetRaySpace,r))&&(h.matrix.fromArray(l.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),l.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(l.linearVelocity)):h.hasLinearVelocity=!1,l.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(l.angularVelocity)):h.hasAngularVelocity=!1,this.dispatchEvent(n)),c&&t.hand){o=!0;for(var p,g=i.createForOfIteratorHelperLoose(t.hand.values());!(p=g()).done;){var y=p.value,d=e.getJointPose(y,r);if(void 0===c.joints[y.jointName]){var _=new a.Group;_.matrixAutoUpdate=!1,_.visible=!1,c.joints[y.jointName]=_,c.add(_)}var v=c.joints[y.jointName];null!==d&&(v.matrix.fromArray(d.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=d.radius),v.visible=null!==d}var V=c.joints["index-finger-tip"],m=c.joints["thumb-tip"],f=V.position.distanceTo(m.position);c.inputState.pinching&&f>.025?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&f<=.015&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==u&&t.gripSpace&&null!==(s=e.getPose(t.gripSpace,r))&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1);return null!==h&&(h.visible=null!==l),null!==u&&(u.visible=null!==s),null!==c&&(c.visible=null!==o),this},t}();t.WebXRController=r,Object.defineProperty(t,"__esModule",{value:!0})}));
