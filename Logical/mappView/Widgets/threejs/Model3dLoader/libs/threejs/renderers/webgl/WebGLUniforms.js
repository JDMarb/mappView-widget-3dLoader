/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports","../../textures/CubeTexture","../../textures/Texture","../../textures/DataArrayTexture","../../textures/Data3DTexture"],(function(r,e,t,i,a){"use strict";var n=new t.Texture,s=new i.DataArrayTexture,u=new a.Data3DTexture,c=new e.CubeTexture,f=[],o=[],h=new Float32Array(16),d=new Float32Array(9),v=new Float32Array(4);function m(r,e,t){var i=r[0];if(i<=0||i>0)return r;var a=e*t,n=f[a];if(void 0===n&&(n=new Float32Array(a),f[a]=n),0!==e){i.toArray(n,0);for(var s=1,u=0;s!==e;++s)u+=t,r[s].toArray(n,u)}return n}function l(r,e){if(r.length!==e.length)return!1;for(var t=0,i=r.length;t<i;t++)if(r[t]!==e[t])return!1;return!0}function x(r,e){for(var t=0,i=e.length;t<i;t++)r[t]=e[t]}function y(r,e){var t=o[e];void 0===t&&(t=new Int32Array(e),o[e]=t);for(var i=0;i!==e;++i)t[i]=r.allocateTextureUnit();return t}function T(r,e){var t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function g(r,e){var t=this.cache;if(void 0!==e.x)t[0]===e.x&&t[1]===e.y||(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(l(t,e))return;r.uniform2fv(this.addr,e),x(t,e)}}function p(r,e){var t=this.cache;if(void 0!==e.x)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(l(t,e))return;r.uniform3fv(this.addr,e),x(t,e)}}function w(r,e){var t=this.cache;if(void 0!==e.x)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(l(t,e))return;r.uniform4fv(this.addr,e),x(t,e)}}function z(r,e){var t=this.cache,i=e.elements;if(void 0===i){if(l(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),x(t,e)}else{if(l(t,i))return;v.set(i),r.uniformMatrix2fv(this.addr,!1,v),x(t,i)}}function A(r,e){var t=this.cache,i=e.elements;if(void 0===i){if(l(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),x(t,e)}else{if(l(t,i))return;d.set(i),r.uniformMatrix3fv(this.addr,!1,d),x(t,i)}}function D(r,e){var t=this.cache,i=e.elements;if(void 0===i){if(l(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),x(t,e)}else{if(l(t,i))return;h.set(i),r.uniformMatrix4fv(this.addr,!1,h),x(t,i)}}function b(r,e){var t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function M(r,e){var t=this.cache;l(t,e)||(r.uniform2iv(this.addr,e),x(t,e))}function U(r,e){var t=this.cache;l(t,e)||(r.uniform3iv(this.addr,e),x(t,e))}function V(r,e){var t=this.cache;l(t,e)||(r.uniform4iv(this.addr,e),x(t,e))}function q(r,e){var t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function C(r,e){var t=this.cache;l(t,e)||(r.uniform2uiv(this.addr,e),x(t,e))}function F(r,e){var t=this.cache;l(t,e)||(r.uniform3uiv(this.addr,e),x(t,e))}function I(r,e){var t=this.cache;l(t,e)||(r.uniform4uiv(this.addr,e),x(t,e))}function P(r,e,t){var i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.setTexture2D(e||n,a)}function L(r,e,t){var i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.setTexture3D(e||u,a)}function O(r,e,t){var i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.setTextureCube(e||c,a)}function W(r,e,t){var i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.setTexture2DArray(e||s,a)}function _(r,e){r.uniform1fv(this.addr,e)}function j(r,e){var t=m(e,this.size,2);r.uniform2fv(this.addr,t)}function k(r,e){var t=m(e,this.size,3);r.uniform3fv(this.addr,t)}function G(r,e){var t=m(e,this.size,4);r.uniform4fv(this.addr,t)}function B(r,e){var t=m(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function E(r,e){var t=m(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function H(r,e){var t=m(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function J(r,e){r.uniform1iv(this.addr,e)}function K(r,e){r.uniform2iv(this.addr,e)}function N(r,e){r.uniform3iv(this.addr,e)}function Q(r,e){r.uniform4iv(this.addr,e)}function R(r,e){r.uniform1uiv(this.addr,e)}function S(r,e){r.uniform2uiv(this.addr,e)}function X(r,e){r.uniform3uiv(this.addr,e)}function Y(r,e){r.uniform4uiv(this.addr,e)}function Z(r,e,t){var i=e.length,a=y(t,i);r.uniform1iv(this.addr,a);for(var s=0;s!==i;++s)t.setTexture2D(e[s]||n,a[s])}function $(r,e,t){var i=e.length,a=y(t,i);r.uniform1iv(this.addr,a);for(var n=0;n!==i;++n)t.setTexture3D(e[n]||u,a[n])}function rr(r,e,t){var i=e.length,a=y(t,i);r.uniform1iv(this.addr,a);for(var n=0;n!==i;++n)t.setTextureCube(e[n]||c,a[n])}function er(r,e,t){var i=e.length,a=y(t,i);r.uniform1iv(this.addr,a);for(var n=0;n!==i;++n)t.setTexture2DArray(e[n]||s,a[n])}var tr=function(r,e,t){this.id=r,this.addr=t,this.cache=[],this.setValue=function(r){switch(r){case 5126:return T;case 35664:return g;case 35665:return p;case 35666:return w;case 35674:return z;case 35675:return A;case 35676:return D;case 5124:case 35670:return b;case 35667:case 35671:return M;case 35668:case 35672:return U;case 35669:case 35673:return V;case 5125:return q;case 36294:return C;case 36295:return F;case 36296:return I;case 35678:case 36198:case 36298:case 36306:case 35682:return P;case 35679:case 36299:case 36307:return L;case 35680:case 36300:case 36308:case 36293:return O;case 36289:case 36303:case 36311:case 36292:return W}}(e.type)},ir=function(r,e,t){this.id=r,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function(r){switch(r){case 5126:return _;case 35664:return j;case 35665:return k;case 35666:return G;case 35674:return B;case 35675:return E;case 35676:return H;case 5124:case 35670:return J;case 35667:case 35671:return K;case 35668:case 35672:return N;case 35669:case 35673:return Q;case 5125:return R;case 36294:return S;case 36295:return X;case 36296:return Y;case 35678:case 36198:case 36298:case 36306:case 35682:return Z;case 35679:case 36299:case 36307:return $;case 35680:case 36300:case 36308:case 36293:return rr;case 36289:case 36303:case 36311:case 36292:return er}}(e.type)},ar=function(){function r(r){this.id=r,this.seq=[],this.map={}}return r.prototype.setValue=function(r,e,t){for(var i=this.seq,a=0,n=i.length;a!==n;++a){var s=i[a];s.setValue(r,e[s.id],t)}},r}(),nr=/(\w+)(\])?(\[|\.)?/g;function sr(r,e){r.seq.push(e),r.map[e.id]=e}function ur(r,e,t){var i=r.name,a=i.length;for(nr.lastIndex=0;;){var n=nr.exec(i),s=nr.lastIndex,u=n[1],c="]"===n[2],f=n[3];if(c&&(u|=0),void 0===f||"["===f&&s+2===a){sr(t,void 0===f?new tr(u,r,e):new ir(u,r,e));break}var o=t.map[u];void 0===o&&sr(t,o=new ar(u)),t=o}}var cr=function(){function r(r,e){this.seq=[],this.map={};for(var t=r.getProgramParameter(e,35718),i=0;i<t;++i){var a=r.getActiveUniform(e,i);ur(a,r.getUniformLocation(e,a.name),this)}}var e=r.prototype;return e.setValue=function(r,e,t,i){var a=this.map[e];void 0!==a&&a.setValue(r,t,i)},e.setOptional=function(r,e,t){var i=e[t];void 0!==i&&this.setValue(r,t,i)},r.upload=function(r,e,t,i){for(var a=0,n=e.length;a!==n;++a){var s=e[a],u=t[s.id];!1!==u.needsUpdate&&s.setValue(r,u.value,i)}},r.seqWithValue=function(r,e){for(var t=[],i=0,a=r.length;i!==a;++i){var n=r[i];n.id in e&&t.push(n)}return t},r}();r.WebGLUniforms=cr,Object.defineProperty(r,"__esModule",{value:!0})}));
