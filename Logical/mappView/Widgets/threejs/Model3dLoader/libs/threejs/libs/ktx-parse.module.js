/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
define(["exports"],(function(t){"use strict";var e=function(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null},n=function(){function t(t,e,n,i){this._dataView=new DataView(t.buffer,t.byteOffset+e,n),this._littleEndian=i,this._offset=0}var e=t.prototype;return e._nextUint8=function(){var t=this._dataView.getUint8(this._offset);return this._offset+=1,t},e._nextUint16=function(){var t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t},e._nextUint32=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t},e._nextUint64=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian)+Math.pow(2,32)*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t},e._nextInt32=function(){var t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t},e._skip=function(t){return this._offset+=t,this},e._scan=function(t,e){void 0===e&&(e=0);for(var n=this._offset,i=0;this._dataView.getUint8(this._offset)!==e&&i<t;)i++,this._offset++;return i<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)},t}(),i=[171,75,84,88,32,50,48,187,13,10,26,10];function _(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}t.KTX2Container=e,t.VK_FORMAT_R16G16B16A16_SFLOAT=97,t.VK_FORMAT_R16G16_SFLOAT=83,t.VK_FORMAT_R16_SFLOAT=76,t.VK_FORMAT_R32G32B32A32_SFLOAT=109,t.VK_FORMAT_R32G32_SFLOAT=103,t.VK_FORMAT_R32_SFLOAT=100,t.VK_FORMAT_R8G8B8A8_SRGB=43,t.VK_FORMAT_R8G8B8A8_UNORM=37,t.VK_FORMAT_R8G8_SRGB=22,t.VK_FORMAT_R8G8_UNORM=16,t.VK_FORMAT_R8_SRGB=15,t.VK_FORMAT_R8_UNORM=9,t.VK_FORMAT_UNDEFINED=0,t.read=function(t){var s=new Uint8Array(t.buffer,t.byteOffset,i.length);if(s[0]!==i[0]||s[1]!==i[1]||s[2]!==i[2]||s[3]!==i[3]||s[4]!==i[4]||s[5]!==i[5]||s[6]!==i[6]||s[7]!==i[7]||s[8]!==i[8]||s[9]!==i[9]||s[10]!==i[10]||s[11]!==i[11])throw new Error("Missing KTX 2.0 identifier.");var r=new e,a=17*Uint32Array.BYTES_PER_ELEMENT,f=new n(t,i.length,a,!0);r.vkFormat=f._nextUint32(),r.typeSize=f._nextUint32(),r.pixelWidth=f._nextUint32(),r.pixelHeight=f._nextUint32(),r.pixelDepth=f._nextUint32(),r.layerCount=f._nextUint32(),r.faceCount=f._nextUint32();var o=f._nextUint32();r.supercompressionScheme=f._nextUint32();for(var U=f._nextUint32(),l=f._nextUint32(),x=f._nextUint32(),h=f._nextUint32(),p=f._nextUint64(),c=f._nextUint64(),u=new n(t,i.length+a,3*o*8,!0),d=0;d<o;d++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});for(var y=new n(t,U,l,!0),O={vendorId:y._skip(4)._nextUint16(),descriptorType:y._nextUint16(),versionNumber:y._nextUint16(),descriptorBlockSize:y._nextUint16(),colorModel:y._nextUint8(),colorPrimaries:y._nextUint8(),transferFunction:y._nextUint8(),flags:y._nextUint8(),texelBlockDimension:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],bytesPlane:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],samples:[]},w=(O.descriptorBlockSize/4-6)/4,R=0;R<w;R++){var A={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelType:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&A.channelType?(A.sampleLower=y._nextInt32(),A.sampleUpper=y._nextInt32()):(A.sampleLower=y._nextUint32(),A.sampleUpper=y._nextUint32()),O.samples[R]=A}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(O);for(var m=new n(t,x,h,!0);m._offset<h;){var b=m._nextUint32(),g=m._scan(b),v=_(g),T=m._scan(b-g.byteLength);r.keyValue[v]=v.match(/^ktx/i)?_(T):T,m._offset%4&&m._skip(4-m._offset%4)}if(c<=0)return r;for(var F=new n(t,p,c,!0),V=F._nextUint16(),M=F._nextUint16(),S=F._nextUint32(),D=F._nextUint32(),B=F._nextUint32(),K=F._nextUint32(),L=[],E=0;E<o;E++)L.push({imageFlags:F._nextUint32(),rgbSliceByteOffset:F._nextUint32(),rgbSliceByteLength:F._nextUint32(),alphaSliceByteOffset:F._nextUint32(),alphaSliceByteLength:F._nextUint32()});var k=p+F._offset,G=k+S,N=G+D,C=N+B,I=new Uint8Array(t.buffer,t.byteOffset+k,S),P=new Uint8Array(t.buffer,t.byteOffset+G,D),z=new Uint8Array(t.buffer,t.byteOffset+N,B),H=new Uint8Array(t.buffer,t.byteOffset+C,K);return r.globalData={endpointCount:V,selectorCount:M,imageDescs:L,endpointsData:I,selectorsData:P,tablesData:z,extendedData:H},r},Object.defineProperty(t,"__esModule",{value:!0})}));
